# Activation System Flow Diagram

## 1. First Install Flow

```
┌─────────────────────────────────────────────────────────────────┐
│                         FIRST INSTALL                            │
└─────────────────────────────────────────────────────────────────┘

┌──────────┐
│  User    │
│ Install  │
│   App    │
└────┬─────┘
     │
     v
┌─────────────────┐
│  MainActivity   │
│  onCreate()     │
└────┬────────────┘
     │
     v
┌──────────────────────┐      ┌──────────────────┐
│ Check Activation     │─────>│ isActivated()?   │
│ ActivationRepository │      └────┬─────────────┘
└──────────────────────┘           │
                                   │ false
                                   v
                        ┌────────────────────┐
                        │ ActivationScreen   │
                        │                    │
                        │ - Show Device ID   │
                        │ - Input SN field   │
                        └────┬───────────────┘
                             │
                     ┌───────┴───────┐
                     │ User inputs   │
                     │ Serial Number │
                     └───────┬───────┘
                             │
                             v
                  ┌─────────────────────┐
                  │ POST /api/activate  │
                  │                     │
                  │ {                   │
                  │   "serialNumber",   │
                  │   "deviceId"        │
                  │ }                   │
                  └──────┬──────────────┘
                         │
                         v
            ┌────────────────────────────┐
            │      Server Process         │
            │                             │
            │ 1. Validate SN              │
            │ 2. Check if used            │
            │ 3. Check device             │
            │ 4. Generate signature       │
            │ 5. Save to DB               │
            └──────┬─────────────────────┘
                   │
        ┌──────────┴──────────┐
        │ Success             │ Error
        v                     v
┌────────────────┐    ┌──────────────┐
│ Response:      │    │ Response:    │
│ {              │    │ {            │
│  success: true │    │  success:    │
│  signature,    │    │    false,    │
│  expiry        │    │  message     │
│ }              │    │ }            │
└───┬────────────┘    └──┬───────────┘
    │                    │
    v                    v
┌──────────────┐   ┌─────────────┐
│ Verify       │   │ Show Error  │
│ Signature    │   │ Message     │
└───┬──────────┘   └─────────────┘
    │
    v
┌──────────────────┐
│ Save to          │
│ Encrypted        │
│ SharedPreferences│
└───┬──────────────┘
    │
    v
┌──────────────┐
│ Navigate to  │
│ Auth Screen  │
└──────────────┘
```

## 2. Subsequent Launch Flow

```
┌─────────────────────────────────────────────────────────────────┐
│                    SUBSEQUENT LAUNCHES                           │
└─────────────────────────────────────────────────────────────────┘

┌──────────┐
│  User    │
│  Opens   │
│   App    │
└────┬─────┘
     │
     v
┌─────────────────┐
│  MainActivity   │
│  onCreate()     │
└────┬────────────┘
     │
     v
┌──────────────────────┐
│ ActivationRepository │
│ isActivated()        │
└────┬─────────────────┘
     │
     v
┌─────────────────────┐
│ 1. Check stored     │
│    activation       │
│ 2. Verify signature │
│ 3. Check expiry     │
└────┬────────────────┘
     │
     │ true
     v
┌──────────────┐
│ Navigate to  │
│ Auth Screen  │
│ (Skip        │
│  Activation) │
└──────────────┘
```

## 3. Settings Activation Info

```
┌─────────────────────────────────────────────────────────────────┐
│                      SETTINGS SCREEN                             │
└─────────────────────────────────────────────────────────────────┘

┌──────────────┐
│ User opens   │
│  Settings    │
└──────┬───────┘
       │
       v
┌──────────────────────┐
│ StoreSettingsScreen  │
│                      │
│ ┌────────────────┐   │
│ │ActivationInfo │   │
│ │     Card      │   │
│ └───────┬────────┘   │
│         │            │
│    ┌────┴─────┐      │
│    │ Activated│      │
│    └────┬─────┘      │
│         │            │
│    ┌────┴────────┐   │
│    │ Display:    │   │
│    │ - Status    │   │
│    │ - SN        │   │
│    │ - Expiry    │   │
│    │ - Device ID │   │
│    └─────────────┘   │
└──────────────────────┘
```

## 4. Data Flow

```
┌────────────────────────────────────────────────────────────────┐
│                        DATA SECURITY                            │
└────────────────────────────────────────────────────────────────┘

┌────────────────┐
│   User Input   │
│ Serial Number  │
└───────┬────────┘
        │
        v
┌────────────────────┐
│  ActivationVM      │
│  activate(sn)      │
└────────┬───────────┘
         │
         v
┌────────────────────────┐
│ ActivationRepository   │
│ activateDevice(sn)     │
└────────┬───────────────┘
         │
         v
┌─────────────────────────┐
│ ActivationApiService    │
│ POST /api/activate      │
└────────┬────────────────┘
         │
         v
┌─────────────────────────┐       ┌──────────────────┐
│  Server Response        │──────>│ SignatureVerifier│
│  {                      │       │ verify(data, sig)│
│    signature: "...",    │       └──────────────────┘
│    expiry: 1234567890   │              │
│  }                      │              │ ✓ Valid
└─────────────────────────┘              │
                                         v
                              ┌────────────────────────┐
                              │ SecurePreferences      │
                              │ (EncryptedSharedPrefs) │
                              │                        │
                              │ ┌────────────────────┐ │
                              │ │ Serial Number      │ │
                              │ │ [AES256-GCM]       │ │
                              │ ├────────────────────┤ │
                              │ │ Signature          │ │
                              │ │ [AES256-GCM]       │ │
                              │ ├────────────────────┤ │
                              │ │ Expiry             │ │
                              │ │ [AES256-GCM]       │ │
                              │ ├────────────────────┤ │
                              │ │ Status             │ │
                              │ │ [AES256-GCM]       │ │
                              │ └────────────────────┘ │
                              └────────────────────────┘
```

## 5. Security Architecture

```
┌─────────────────────────────────────────────────────────────────┐
│                    SECURITY LAYERS                               │
└─────────────────────────────────────────────────────────────────┘

         ANDROID APP                         SERVER
┌──────────────────────────┐       ┌──────────────────────────┐
│                          │       │                          │
│  ┌────────────────────┐  │       │  ┌────────────────────┐  │
│  │   Public Key       │  │       │  │   Private Key      │  │
│  │   [Embedded]       │  │       │  │   [SECRET!]        │  │
│  │   RSA 2048-bit     │  │       │  │   RSA 2048-bit     │  │
│  └────────────────────┘  │       │  └────────────────────┘  │
│           │              │       │           │              │
│           v              │       │           v              │
│  ┌────────────────────┐  │       │  ┌────────────────────┐  │
│  │ SignatureVerifier  │  │       │  │ Signature Generator│  │
│  │ verify(data, sig)  │<─┼───────┼──│ sign(data)         │  │
│  └────────────────────┘  │  TLS  │  └────────────────────┘  │
│           │              │       │           │              │
│           v              │       │           v              │
│  ┌────────────────────┐  │       │  ┌────────────────────┐  │
│  │EncryptedSharedPrefs│  │       │  │   PostgreSQL       │  │
│  │  AES256-GCM        │  │       │  │   (Activations)    │  │
│  └────────────────────┘  │       │  └────────────────────┘  │
│           │              │       │           │              │
│           v              │       │           v              │
│  ┌────────────────────┐  │       │  ┌────────────────────┐  │
│  │   SSAID            │  │       │  │   Audit Logs       │  │
│  │   (Device ID)      │  │       │  │                    │  │
│  └────────────────────┘  │       │  └────────────────────┘  │
│                          │       │                          │
└──────────────────────────┘       └──────────────────────────┘
```

## 6. Component Architecture

```
┌─────────────────────────────────────────────────────────────────┐
│                   ANDROID COMPONENTS                             │
└─────────────────────────────────────────────────────────────────┘

┌────────────────────────────────────────────────────────────────┐
│                        UI Layer                                 │
│  ┌──────────────────┐  ┌──────────────────┐  ┌──────────────┐ │
│  │ ActivationScreen │  │ ActivationInfoCard│  │SettingsScreen│ │
│  └────────┬─────────┘  └────────┬─────────┘  └──────┬───────┘ │
└───────────┼─────────────────────┼────────────────────┼─────────┘
            │                     │                    │
            └─────────────┬───────┴────────────────────┘
                          │
┌─────────────────────────┼─────────────────────────────────────┐
│                    ViewModel Layer                             │
│              ┌──────────┴──────────┐                           │
│              │ ActivationViewModel │                           │
│              │   (Hilt)            │                           │
│              └──────────┬──────────┘                           │
└─────────────────────────┼─────────────────────────────────────┘
                          │
┌─────────────────────────┼─────────────────────────────────────┐
│                   Repository Layer                             │
│           ┌─────────────┴──────────────┐                       │
│           │ ActivationRepository       │                       │
│           └─────────────┬──────────────┘                       │
└─────────────────────────┼─────────────────────────────────────┘
                          │
         ┌────────────────┼────────────────┐
         │                │                │
┌────────┴────────┐ ┌─────┴──────┐ ┌──────┴─────────┐
│ ApiService      │ │  Security  │ │   Preferences  │
│ (Retrofit)      │ │  Verifier  │ │   (Encrypted)  │
└─────────────────┘ └────────────┘ └────────────────┘
```

## Legend

```
┌─────┐
│ Box │  = Component/Screen
└─────┘

  │
  v     = Data/Control Flow

─────>  = Network Request

  ✓     = Success/Valid

  ✗     = Error/Invalid

[TEXT]  = Encrypted/Protected
```

