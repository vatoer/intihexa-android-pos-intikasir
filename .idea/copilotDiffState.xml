<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/app/src/main/java/id/stargan/intikasir/feature/history/ui/HistoryScreens.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/id/stargan/intikasir/feature/history/ui/HistoryScreens.kt" />
              <option name="originalContent" value="package id.stargan.intikasir.feature.history.ui&#10;&#10;import androidx.compose.foundation.layout.*&#10;import androidx.compose.foundation.lazy.LazyColumn&#10;import androidx.compose.foundation.lazy.items&#10;import androidx.compose.material.icons.Icons&#10;import androidx.compose.material.icons.automirrored.filled.ArrowBack&#10;import androidx.compose.material.icons.filled.Delete&#10;import androidx.compose.material.icons.filled.FilterList&#10;import androidx.compose.material.icons.filled.Print&#10;import androidx.compose.material.icons.filled.Share&#10;import androidx.compose.material3.*&#10;import androidx.compose.runtime.*&#10;import androidx.compose.ui.Alignment&#10;import androidx.compose.ui.Modifier&#10;import androidx.compose.ui.text.font.FontWeight&#10;import androidx.compose.ui.unit.dp&#10;import androidx.hilt.navigation.compose.hiltViewModel&#10;import id.stargan.intikasir.data.local.entity.TransactionEntity&#10;import id.stargan.intikasir.feature.history.viewmodel.HistoryEvent&#10;import id.stargan.intikasir.feature.history.viewmodel.HistoryViewModel&#10;import java.text.NumberFormat&#10;import java.text.SimpleDateFormat&#10;import java.util.*&#10;&#10;@OptIn(ExperimentalMaterial3Api::class)&#10;@Composable&#10;fun HistoryScreen(&#10;    onBack: () -&gt; Unit,&#10;    onOpenDetail: (String) -&gt; Unit,&#10;    viewModel: HistoryViewModel = hiltViewModel()&#10;) {&#10;    val uiState by viewModel.uiState.collectAsState()&#10;    val dateFormatter = remember { SimpleDateFormat(&quot;dd MMM yyyy, HH:mm&quot;, Locale(&quot;id&quot;, &quot;ID&quot;)) }&#10;    val currency = remember { NumberFormat.getCurrencyInstance(Locale(&quot;id&quot;, &quot;ID&quot;)).apply { maximumFractionDigits = 0 } }&#10;&#10;    // Calculate summary&#10;    val totalTransactions = uiState.transactions.size&#10;    val totalRevenue = uiState.transactions.sumOf { it.total }&#10;&#10;    Scaffold(&#10;        topBar = {&#10;            TopAppBar(&#10;                title = { Text(&quot;Riwayat Transaksi&quot;) },&#10;                navigationIcon = {&#10;                    IconButton(onClick = onBack) {&#10;                        Icon(Icons.AutoMirrored.Filled.ArrowBack, contentDescription = null)&#10;                    }&#10;                },&#10;                actions = {&#10;                    IconButton(onClick = { viewModel.onEvent(HistoryEvent.ToggleFilter) }) {&#10;                        Icon(Icons.Default.FilterList, contentDescription = null)&#10;                    }&#10;                }&#10;            )&#10;        }&#10;    ) { padding -&gt;&#10;        Column(&#10;            modifier = Modifier&#10;                .fillMaxSize()&#10;                .padding(padding)&#10;        ) {&#10;            if (uiState.showFilter) {&#10;                HistoryFilterBar(&#10;                    selectedRange = uiState.range,&#10;                    startDate = uiState.startDate,&#10;                    endDate = uiState.endDate,&#10;                    onRangeChange = { viewModel.onEvent(HistoryEvent.ChangeRange(it)) },&#10;                    onStartDateChange = { viewModel.onEvent(HistoryEvent.ChangeStartDate(it)) },&#10;                    onEndDateChange = { viewModel.onEvent(HistoryEvent.ChangeEndDate(it)) },&#10;                    onApply = { viewModel.onEvent(HistoryEvent.ApplyFilter) }&#10;                )&#10;            }&#10;&#10;            // Summary Card&#10;            if (!uiState.isLoading &amp;&amp; uiState.transactions.isNotEmpty()) {&#10;                Card(&#10;                    modifier = Modifier&#10;                        .fillMaxWidth()&#10;                        .padding(horizontal = 12.dp, vertical = 8.dp),&#10;                    colors = CardDefaults.cardColors(&#10;                        containerColor = MaterialTheme.colorScheme.primaryContainer&#10;                    )&#10;                ) {&#10;                    Row(&#10;                        modifier = Modifier&#10;                            .fillMaxWidth()&#10;                            .padding(16.dp),&#10;                        horizontalArrangement = Arrangement.SpaceBetween&#10;                    ) {&#10;                        Column {&#10;                            Text(&#10;                                text = &quot;Total Transaksi&quot;,&#10;                                style = MaterialTheme.typography.bodySmall,&#10;                                color = MaterialTheme.colorScheme.onPrimaryContainer&#10;                            )&#10;                            Text(&#10;                                text = &quot;$totalTransactions&quot;,&#10;                                style = MaterialTheme.typography.titleLarge,&#10;                                fontWeight = FontWeight.Bold,&#10;                                color = MaterialTheme.colorScheme.onPrimaryContainer&#10;                            )&#10;                        }&#10;                        Column(horizontalAlignment = Alignment.End) {&#10;                            Text(&#10;                                text = &quot;Total Pendapatan&quot;,&#10;                                style = MaterialTheme.typography.bodySmall,&#10;                                color = MaterialTheme.colorScheme.onPrimaryContainer&#10;                            )&#10;                            Text(&#10;                                text = currency.format(totalRevenue).replace(&quot;Rp&quot;, &quot;Rp &quot;),&#10;                                style = MaterialTheme.typography.titleLarge,&#10;                                fontWeight = FontWeight.Bold,&#10;                                color = MaterialTheme.colorScheme.onPrimaryContainer&#10;                            )&#10;                        }&#10;                    }&#10;                }&#10;            }&#10;&#10;            if (uiState.isLoading) {&#10;                Box(modifier = Modifier.fillMaxSize(), contentAlignment = Alignment.Center) {&#10;                    CircularProgressIndicator()&#10;                }&#10;            } else {&#10;                LazyColumn(modifier = Modifier.fillMaxSize(), contentPadding = PaddingValues(12.dp), verticalArrangement = Arrangement.spacedBy(8.dp)) {&#10;                    items(uiState.transactions) { tx -&gt;&#10;                        TransactionRow(&#10;                            tx = tx,&#10;                            currency = currency,&#10;                            dateFormatter = dateFormatter,&#10;                            onClick = { onOpenDetail(tx.id) }&#10;                        )&#10;                    }&#10;                }&#10;            }&#10;        }&#10;    }&#10;}&#10;&#10;@Composable&#10;private fun HistoryFilterBar(&#10;    selectedRange: DateRange,&#10;    startDate: Long,&#10;    endDate: Long,&#10;    onRangeChange: (DateRange) -&gt; Unit,&#10;    onStartDateChange: (Long) -&gt; Unit,&#10;    onEndDateChange: (Long) -&gt; Unit,&#10;    onApply: () -&gt; Unit&#10;) {&#10;    Column(Modifier.fillMaxWidth().padding(12.dp), verticalArrangement = Arrangement.spacedBy(8.dp)) {&#10;        // Preset chips&#10;        FlowRow(horizontalArrangement = Arrangement.spacedBy(8.dp)) {&#10;            DateRange.values().forEach { range -&gt;&#10;                FilterChip(&#10;                    selected = selectedRange == range,&#10;                    onClick = { onRangeChange(range) },&#10;                    label = { Text(range.label) }&#10;                )&#10;            }&#10;        }&#10;        if (selectedRange == DateRange.CUSTOM) {&#10;            Row(horizontalArrangement = Arrangement.spacedBy(8.dp)) {&#10;                OutlinedTextField(&#10;                    value = startDate.toString(),&#10;                    onValueChange = {},&#10;                    readOnly = true,&#10;                    label = { Text(&quot;Dari&quot;) },&#10;                    modifier = Modifier.weight(1f)&#10;                )&#10;                OutlinedTextField(&#10;                    value = endDate.toString(),&#10;                    onValueChange = {},&#10;                    readOnly = true,&#10;                    label = { Text(&quot;Sampai&quot;) },&#10;                    modifier = Modifier.weight(1f)&#10;                )&#10;            }&#10;        }&#10;        Row(Modifier.fillMaxWidth(), horizontalArrangement = Arrangement.End) {&#10;            Button(onClick = onApply) { Text(&quot;Terapkan&quot;) }&#10;        }&#10;    }&#10;}&#10;&#10;@Composable&#10;private fun TransactionRow(&#10;    tx: TransactionEntity,&#10;    currency: NumberFormat,&#10;    dateFormatter: SimpleDateFormat,&#10;    onClick: () -&gt; Unit&#10;) {&#10;    ElevatedCard(onClick = onClick) {&#10;        Row(&#10;            modifier = Modifier.fillMaxWidth().padding(12.dp),&#10;            horizontalArrangement = Arrangement.SpaceBetween,&#10;            verticalAlignment = Alignment.CenterVertically&#10;        ) {&#10;            Column(Modifier.weight(1f)) {&#10;                Text(tx.transactionNumber, style = MaterialTheme.typography.titleMedium, fontWeight = FontWeight.Bold)&#10;                Text(dateFormatter.format(Date(tx.updatedAt)), style = MaterialTheme.typography.bodySmall)&#10;                Text(&quot;Kasir: ${tx.cashierName}&quot;, style = MaterialTheme.typography.bodySmall)&#10;            }&#10;            Column(horizontalAlignment = Alignment.End) {&#10;                Text(currency.format(tx.total).replace(&quot;Rp&quot;, &quot;Rp &quot;), style = MaterialTheme.typography.titleMedium)&#10;                Text(tx.status.name, style = MaterialTheme.typography.bodySmall)&#10;            }&#10;        }&#10;    }&#10;}&#10;&#10;@OptIn(ExperimentalMaterial3Api::class)&#10;@Composable&#10;fun HistoryDetailScreen(&#10;    transactionId: String,&#10;    onBack: () -&gt; Unit,&#10;    onPrint: (TransactionEntity) -&gt; Unit,&#10;    onShare: (TransactionEntity) -&gt; Unit,&#10;    onDelete: (TransactionEntity) -&gt; Unit,&#10;    isAdmin: Boolean = false,&#10;    viewModel: HistoryViewModel = hiltViewModel()&#10;) {&#10;    val uiState by viewModel.detailUiState.collectAsState()&#10;    val currency = remember { NumberFormat.getCurrencyInstance(Locale(&quot;id&quot;, &quot;ID&quot;)).apply { maximumFractionDigits = 0 } }&#10;    val dateFormatter = remember { SimpleDateFormat(&quot;dd MMM yyyy, HH:mm&quot;, Locale(&quot;id&quot;, &quot;ID&quot;)) }&#10;&#10;    LaunchedEffect(transactionId) { viewModel.onEvent(HistoryEvent.LoadDetail(transactionId)) }&#10;&#10;    Scaffold(&#10;        topBar = {&#10;            TopAppBar(&#10;                title = { Text(&quot;Detil Transaksi&quot;) },&#10;                navigationIcon = {&#10;                    IconButton(onClick = onBack) { Icon(Icons.AutoMirrored.Filled.ArrowBack, contentDescription = null) }&#10;                }&#10;            )&#10;        }&#10;    ) { padding -&gt;&#10;        if (uiState.isLoading) {&#10;            Box(Modifier.fillMaxSize().padding(padding), contentAlignment = Alignment.Center) { CircularProgressIndicator() }&#10;        } else uiState.transaction?.let { tx -&gt;&#10;            LazyColumn(&#10;                modifier = Modifier.fillMaxSize().padding(padding),&#10;                contentPadding = PaddingValues(16.dp),&#10;                verticalArrangement = Arrangement.spacedBy(12.dp)&#10;            ) {&#10;                item {&#10;                    Text(tx.transactionNumber, style = MaterialTheme.typography.titleLarge, fontWeight = FontWeight.Bold)&#10;                    Text(&quot;Tanggal: ${dateFormatter.format(Date(tx.updatedAt))}&quot;)&#10;                    Text(&quot;Kasir: ${tx.cashierName}&quot;)&#10;                    Text(&quot;Status: ${tx.status.name}&quot;)&#10;                    Text(&quot;Metode Bayar: ${tx.paymentMethod.name}&quot;)&#10;                    HorizontalDivider()&#10;                }&#10;                // Items header&#10;                if (uiState.items.isNotEmpty()) {&#10;                    item {&#10;                        Row(&#10;                            modifier = Modifier.fillMaxWidth(),&#10;                            horizontalArrangement = Arrangement.SpaceBetween,&#10;                            verticalAlignment = Alignment.CenterVertically&#10;                        ) {&#10;                            Text(&quot;Item Dibeli&quot;, style = MaterialTheme.typography.titleMedium)&#10;                            Text(&#10;                                &quot;${uiState.items.size} item • ${uiState.items.sumOf { it.quantity }} pcs&quot;,&#10;                                style = MaterialTheme.typography.bodySmall,&#10;                                color = MaterialTheme.colorScheme.onSurfaceVariant&#10;                            )&#10;                        }&#10;                    }&#10;                    items(uiState.items) { item -&gt;&#10;                        ItemDetailRow(&#10;                            name = item.productName,&#10;                            quantity = item.quantity,&#10;                            unitPrice = item.unitPrice,&#10;                            discount = item.discount,&#10;                            subtotal = item.subtotal,&#10;                            currency = currency&#10;                        )&#10;                    }&#10;                    item { HorizontalDivider() }&#10;                } else {&#10;                    item { Text(&quot;Tidak ada item&quot;, style = MaterialTheme.typography.bodyMedium) }&#10;                }&#10;                // Totals section&#10;                item {&#10;                    val subtotalStr = currency.format(tx.subtotal).replace(&quot;Rp&quot;, &quot;Rp &quot;)&#10;                    val taxStr = currency.format(tx.tax).replace(&quot;Rp&quot;, &quot;Rp &quot;)&#10;                    val discountStr = currency.format(tx.discount).replace(&quot;Rp&quot;, &quot;Rp &quot;)&#10;                    val totalStr = currency.format(tx.total).replace(&quot;Rp&quot;, &quot;Rp &quot;)&#10;                    Column(verticalArrangement = Arrangement.spacedBy(4.dp)) {&#10;                        Text(&quot;Subtotal: $subtotalStr&quot;)&#10;                        if (tx.tax &gt; 0) Text(&quot;PPN: $taxStr&quot;)&#10;                        if (tx.discount &gt; 0) Text(&quot;Diskon: -$discountStr&quot;)&#10;                        Text(&quot;Total: $totalStr&quot;, fontWeight = FontWeight.Bold)&#10;                        if (tx.cashReceived &gt; 0) {&#10;                            val receivedStr = currency.format(tx.cashReceived).replace(&quot;Rp&quot;, &quot;Rp &quot;)&#10;                            val changeStr = currency.format(tx.cashChange).replace(&quot;Rp&quot;, &quot;Rp &quot;)&#10;                            Text(&quot;Dibayar: $receivedStr&quot;)&#10;                            Text(&quot;Kembalian: $changeStr&quot;)&#10;                        }&#10;                    }&#10;                    HorizontalDivider()&#10;                }&#10;                // Actions - improved with Share button and Admin-only Delete&#10;                item {&#10;                    Column(verticalArrangement = Arrangement.spacedBy(8.dp)) {&#10;                        Row(horizontalArrangement = Arrangement.spacedBy(8.dp)) {&#10;                            Button(onClick = { onPrint(tx) }, modifier = Modifier.weight(1f)) {&#10;                                Icon(Icons.Default.Print, contentDescription = null)&#10;                                Spacer(Modifier.width(6.dp))&#10;                                Text(&quot;Cetak&quot;)&#10;                            }&#10;                            Button(onClick = { onShare(tx) }, modifier = Modifier.weight(1f)) {&#10;                                Icon(Icons.Default.Share, contentDescription = null)&#10;                                Spacer(Modifier.width(6.dp))&#10;                                Text(&quot;Bagikan&quot;)&#10;                            }&#10;                        }&#10;                        // Delete button - only for Admin&#10;                        if (isAdmin) {&#10;                            OutlinedButton(&#10;                                onClick = { onDelete(tx) },&#10;                                modifier = Modifier.fillMaxWidth(),&#10;                                colors = ButtonDefaults.outlinedButtonColors(contentColor = MaterialTheme.colorScheme.error)&#10;                            ) {&#10;                                Icon(Icons.Default.Delete, contentDescription = null)&#10;                                Spacer(Modifier.width(6.dp))&#10;                                Text(&quot;Hapus Transaksi (Admin)&quot;)&#10;                            }&#10;                        }&#10;                    }&#10;                }&#10;                // Bottom spacing&#10;                item { Spacer(Modifier.height(32.dp)) }&#10;            }&#10;        }&#10;    }&#10;}&#10;&#10;@Composable&#10;private fun ItemDetailRow(&#10;    name: String,&#10;    quantity: Int,&#10;    unitPrice: Double,&#10;    discount: Double,&#10;    subtotal: Double,&#10;    currency: NumberFormat&#10;) {&#10;    ElevatedCard {&#10;        Column(Modifier.fillMaxWidth().padding(12.dp), verticalArrangement = Arrangement.spacedBy(4.dp)) {&#10;            Text(name, style = MaterialTheme.typography.bodyMedium, fontWeight = FontWeight.SemiBold)&#10;            val unitStr = currency.format(unitPrice).replace(&quot;Rp&quot;, &quot;Rp &quot;)&#10;            val subStr = currency.format(subtotal).replace(&quot;Rp&quot;, &quot;Rp &quot;)&#10;            Text(&quot;$quantity x $unitStr = $subStr&quot;, style = MaterialTheme.typography.bodySmall)&#10;            if (discount &gt; 0) {&#10;                val discountStr = currency.format(discount).replace(&quot;Rp&quot;, &quot;Rp &quot;)&#10;                Text(&quot;Diskon item: -$discountStr&quot;, style = MaterialTheme.typography.bodySmall, color = MaterialTheme.colorScheme.primary)&#10;            }&#10;        }&#10;    }&#10;}&#10;&#10;enum class DateRange(val label: String) {&#10;    TODAY(&quot;Hari ini&quot;),&#10;    YESTERDAY(&quot;Kemarin&quot;),&#10;    LAST_7_DAYS(&quot;7 hari terakhir&quot;),&#10;    THIS_MONTH(&quot;Bulan ini&quot;),&#10;    LAST_MONTH(&quot;Bulan lalu&quot;),&#10;    CUSTOM(&quot;Custom&quot;)&#10;}&#10;" />
              <option name="updatedContent" value="package id.stargan.intikasir.feature.history.ui&#10;&#10;import androidx.compose.foundation.layout.*&#10;import androidx.compose.foundation.lazy.LazyColumn&#10;import androidx.compose.foundation.lazy.items&#10;import androidx.compose.material.icons.Icons&#10;import androidx.compose.material.icons.automirrored.filled.ArrowBack&#10;import androidx.compose.material.icons.filled.Delete&#10;import androidx.compose.material.icons.filled.FilterList&#10;import androidx.compose.material.icons.filled.Print&#10;import androidx.compose.material.icons.filled.Share&#10;import androidx.compose.material.icons.filled.FileDownload&#10;import androidx.compose.material3.*&#10;import androidx.compose.runtime.*&#10;import androidx.compose.ui.Alignment&#10;import androidx.compose.ui.Modifier&#10;import androidx.compose.ui.platform.LocalContext&#10;import androidx.compose.ui.text.font.FontWeight&#10;import androidx.compose.ui.unit.dp&#10;import androidx.hilt.navigation.compose.hiltViewModel&#10;import id.stargan.intikasir.data.local.entity.TransactionEntity&#10;import id.stargan.intikasir.data.local.entity.TransactionStatus&#10;import id.stargan.intikasir.feature.history.viewmodel.HistoryEvent&#10;import id.stargan.intikasir.feature.history.viewmodel.HistoryViewModel&#10;import id.stargan.intikasir.feature.history.ui.components.DateRangePickerModal&#10;import id.stargan.intikasir.feature.history.ui.components.formatDateRange&#10;import id.stargan.intikasir.feature.history.util.ExportUtil&#10;import kotlinx.coroutines.launch&#10;import java.text.NumberFormat&#10;import java.text.SimpleDateFormat&#10;import java.util.*&#10;&#10;@OptIn(ExperimentalMaterial3Api::class)&#10;@Composable&#10;fun HistoryScreen(&#10;    onBack: () -&gt; Unit,&#10;    onOpenDetail: (String) -&gt; Unit,&#10;    viewModel: HistoryViewModel = hiltViewModel()&#10;) {&#10;    val uiState by viewModel.uiState.collectAsState()&#10;    val toastMessage by viewModel.toastMessage.collectAsState()&#10;    val dateFormatter = remember { SimpleDateFormat(&quot;dd MMM yyyy, HH:mm&quot;, Locale(&quot;id&quot;, &quot;ID&quot;)) }&#10;    val currency = remember { NumberFormat.getCurrencyInstance(Locale(&quot;id&quot;, &quot;ID&quot;)).apply { maximumFractionDigits = 0 } }&#10;    val context = LocalContext.current&#10;    val scope = rememberCoroutineScope()&#10;    val snackbarHostState = remember { SnackbarHostState() }&#10;&#10;    // Calculate summary&#10;    val totalTransactions = uiState.transactions.size&#10;    val totalRevenue = uiState.transactions.sumOf { it.total }&#10;&#10;    var showExportMenu by remember { mutableStateOf(false) }&#10;&#10;    // Show toast message&#10;    LaunchedEffect(toastMessage) {&#10;        toastMessage?.let { message -&gt;&#10;            snackbarHostState.showSnackbar(&#10;                message = message,&#10;                duration = SnackbarDuration.Short&#10;            )&#10;            viewModel.onEvent(HistoryEvent.DismissToast)&#10;        }&#10;    }&#10;&#10;    Scaffold(&#10;        topBar = {&#10;            TopAppBar(&#10;                title = { Text(&quot;Riwayat Transaksi&quot;) },&#10;                navigationIcon = {&#10;                    IconButton(onClick = onBack) {&#10;                        Icon(Icons.AutoMirrored.Filled.ArrowBack, contentDescription = null)&#10;                    }&#10;                },&#10;                actions = {&#10;                    IconButton(onClick = { viewModel.onEvent(HistoryEvent.ToggleFilter) }) {&#10;                        Icon(Icons.Default.FilterList, contentDescription = null)&#10;                    }&#10;                    IconButton(onClick = { showExportMenu = true }) {&#10;                        Icon(Icons.Default.FileDownload, contentDescription = &quot;Export&quot;)&#10;                    }&#10;                    DropdownMenu(&#10;                        expanded = showExportMenu,&#10;                        onDismissRequest = { showExportMenu = false }&#10;                    ) {&#10;                        DropdownMenuItem(&#10;                            text = { Text(&quot;Export Ringkasan CSV&quot;) },&#10;                            onClick = {&#10;                                scope.launch {&#10;                                    // Load items for all transactions&#10;                                    val transactionIds = uiState.transactions.map { it.id }&#10;                                    val itemsMap = viewModel.loadAllTransactionItems(transactionIds)&#10;                                    &#10;                                    val file = ExportUtil.exportToCSV(context, uiState.transactions, itemsMap)&#10;                                    ExportUtil.shareCSV(context, file)&#10;                                    showExportMenu = false&#10;                                    snackbarHostState.showSnackbar(&quot;Laporan berhasil diekspor&quot;)&#10;                                }&#10;                            }&#10;                        )&#10;                        DropdownMenuItem(&#10;                            text = { Text(&quot;Export Detail CSV&quot;) },&#10;                            onClick = {&#10;                                scope.launch {&#10;                                    // Load items for all transactions&#10;                                    val transactionIds = uiState.transactions.map { it.id }&#10;                                    val itemsMap = viewModel.loadAllTransactionItems(transactionIds)&#10;                                    &#10;                                    val file = ExportUtil.exportDetailedToCSV(context, uiState.transactions, itemsMap)&#10;                                    ExportUtil.shareCSV(context, file)&#10;                                    showExportMenu = false&#10;                                    snackbarHostState.showSnackbar(&quot;Laporan detail berhasil diekspor&quot;)&#10;                                }&#10;                            }&#10;                        )&#10;                    }&#10;                }&#10;            )&#10;        },&#10;        snackbarHost = { SnackbarHost(snackbarHostState) }&#10;    ) { padding -&gt;&#10;        Column(&#10;            modifier = Modifier&#10;                .fillMaxSize()&#10;                .padding(padding)&#10;        ) {&#10;            if (uiState.showFilter) {&#10;                HistoryFilterBar(&#10;                    selectedRange = uiState.range,&#10;                    startDate = uiState.startDate,&#10;                    endDate = uiState.endDate,&#10;                    selectedStatus = uiState.selectedStatus,&#10;                    onRangeChange = { viewModel.onEvent(HistoryEvent.ChangeRange(it)) },&#10;                    onStartDateChange = { viewModel.onEvent(HistoryEvent.ChangeStartDate(it)) },&#10;                    onEndDateChange = { viewModel.onEvent(HistoryEvent.ChangeEndDate(it)) },&#10;                    onStatusChange = { viewModel.onEvent(HistoryEvent.ChangeStatus(it)) },&#10;                    onApply = { viewModel.onEvent(HistoryEvent.ApplyFilter) }&#10;                )&#10;            }&#10;&#10;            // Summary Card&#10;            if (!uiState.isLoading &amp;&amp; uiState.transactions.isNotEmpty()) {&#10;                Card(&#10;                    modifier = Modifier&#10;                        .fillMaxWidth()&#10;                        .padding(horizontal = 12.dp, vertical = 8.dp),&#10;                    colors = CardDefaults.cardColors(&#10;                        containerColor = MaterialTheme.colorScheme.primaryContainer&#10;                    )&#10;                ) {&#10;                    Row(&#10;                        modifier = Modifier&#10;                            .fillMaxWidth()&#10;                            .padding(16.dp),&#10;                        horizontalArrangement = Arrangement.SpaceBetween&#10;                    ) {&#10;                        Column {&#10;                            Text(&#10;                                text = &quot;Total Transaksi&quot;,&#10;                                style = MaterialTheme.typography.bodySmall,&#10;                                color = MaterialTheme.colorScheme.onPrimaryContainer&#10;                            )&#10;                            Text(&#10;                                text = &quot;$totalTransactions&quot;,&#10;                                style = MaterialTheme.typography.titleLarge,&#10;                                fontWeight = FontWeight.Bold,&#10;                                color = MaterialTheme.colorScheme.onPrimaryContainer&#10;                            )&#10;                        }&#10;                        Column(horizontalAlignment = Alignment.End) {&#10;                            Text(&#10;                                text = &quot;Total Pendapatan&quot;,&#10;                                style = MaterialTheme.typography.bodySmall,&#10;                                color = MaterialTheme.colorScheme.onPrimaryContainer&#10;                            )&#10;                            Text(&#10;                                text = currency.format(totalRevenue).replace(&quot;Rp&quot;, &quot;Rp &quot;),&#10;                                style = MaterialTheme.typography.titleLarge,&#10;                                fontWeight = FontWeight.Bold,&#10;                                color = MaterialTheme.colorScheme.onPrimaryContainer&#10;                            )&#10;                        }&#10;                    }&#10;                }&#10;            }&#10;&#10;            if (uiState.isLoading) {&#10;                Box(modifier = Modifier.fillMaxSize(), contentAlignment = Alignment.Center) {&#10;                    CircularProgressIndicator()&#10;                }&#10;            } else {&#10;                LazyColumn(modifier = Modifier.fillMaxSize(), contentPadding = PaddingValues(12.dp), verticalArrangement = Arrangement.spacedBy(8.dp)) {&#10;                    items(uiState.transactions) { tx -&gt;&#10;                        TransactionRow(&#10;                            tx = tx,&#10;                            currency = currency,&#10;                            dateFormatter = dateFormatter,&#10;                            onClick = { onOpenDetail(tx.id) }&#10;                        )&#10;                    }&#10;                }&#10;            }&#10;        }&#10;    }&#10;}&#10;&#10;@Composable&#10;private fun HistoryFilterBar(&#10;    selectedRange: DateRange,&#10;    startDate: Long,&#10;    endDate: Long,&#10;    selectedStatus: TransactionStatus?,&#10;    onRangeChange: (DateRange) -&gt; Unit,&#10;    onStartDateChange: (Long) -&gt; Unit,&#10;    onEndDateChange: (Long) -&gt; Unit,&#10;    onStatusChange: (TransactionStatus?) -&gt; Unit,&#10;    onApply: () -&gt; Unit&#10;) {&#10;    var showDatePicker by remember { mutableStateOf(false) }&#10;&#10;    Column(Modifier.fillMaxWidth().padding(12.dp), verticalArrangement = Arrangement.spacedBy(8.dp)) {&#10;        // Date range chips&#10;        Text(&quot;Periode&quot;, style = MaterialTheme.typography.labelMedium)&#10;        FlowRow(horizontalArrangement = Arrangement.spacedBy(8.dp)) {&#10;            DateRange.values().forEach { range -&gt;&#10;                FilterChip(&#10;                    selected = selectedRange == range,&#10;                    onClick = { onRangeChange(range) },&#10;                    label = { Text(range.label) }&#10;                )&#10;            }&#10;        }&#10;&#10;        // Show date range for custom&#10;        if (selectedRange == DateRange.CUSTOM) {&#10;            OutlinedButton(&#10;                onClick = { showDatePicker = true },&#10;                modifier = Modifier.fillMaxWidth()&#10;            ) {&#10;                Text(formatDateRange(startDate, endDate))&#10;            }&#10;        }&#10;&#10;        // Status filter&#10;        Text(&quot;Status&quot;, style = MaterialTheme.typography.labelMedium)&#10;        FlowRow(horizontalArrangement = Arrangement.spacedBy(8.dp)) {&#10;            FilterChip(&#10;                selected = selectedStatus == null,&#10;                onClick = { onStatusChange(null) },&#10;                label = { Text(&quot;Semua&quot;) }&#10;            )&#10;            TransactionStatus.values().forEach { status -&gt;&#10;                FilterChip(&#10;                    selected = selectedStatus == status,&#10;                    onClick = { onStatusChange(status) },&#10;                    label = { Text(status.name) }&#10;                )&#10;            }&#10;        }&#10;&#10;        Row(Modifier.fillMaxWidth(), horizontalArrangement = Arrangement.End) {&#10;            Button(onClick = onApply) { Text(&quot;Terapkan&quot;) }&#10;        }&#10;    }&#10;&#10;    DateRangePickerModal(&#10;        showDialog = showDatePicker,&#10;        onDismiss = { showDatePicker = false },&#10;        onDateRangeSelected = { start, end -&gt;&#10;            onStartDateChange(start)&#10;            onEndDateChange(end)&#10;        }&#10;    )&#10;}&#10;&#10;@Composable&#10;private fun TransactionRow(&#10;    tx: TransactionEntity,&#10;    currency: NumberFormat,&#10;    dateFormatter: SimpleDateFormat,&#10;    onClick: () -&gt; Unit&#10;) {&#10;    ElevatedCard(onClick = onClick) {&#10;        Row(&#10;            modifier = Modifier.fillMaxWidth().padding(12.dp),&#10;            horizontalArrangement = Arrangement.SpaceBetween,&#10;            verticalAlignment = Alignment.CenterVertically&#10;        ) {&#10;            Column(Modifier.weight(1f)) {&#10;                Text(tx.transactionNumber, style = MaterialTheme.typography.titleMedium, fontWeight = FontWeight.Bold)&#10;                Text(dateFormatter.format(Date(tx.updatedAt)), style = MaterialTheme.typography.bodySmall)&#10;                Text(&quot;Kasir: ${tx.cashierName}&quot;, style = MaterialTheme.typography.bodySmall)&#10;            }&#10;            Column(horizontalAlignment = Alignment.End) {&#10;                Text(currency.format(tx.total).replace(&quot;Rp&quot;, &quot;Rp &quot;), style = MaterialTheme.typography.titleMedium)&#10;                Text(tx.status.name, style = MaterialTheme.typography.bodySmall)&#10;            }&#10;        }&#10;    }&#10;}&#10;&#10;@OptIn(ExperimentalMaterial3Api::class)&#10;@Composable&#10;fun HistoryDetailScreen(&#10;    transactionId: String,&#10;    onBack: () -&gt; Unit,&#10;    onPrint: (TransactionEntity) -&gt; Unit,&#10;    onShare: (TransactionEntity) -&gt; Unit,&#10;    onDelete: (TransactionEntity) -&gt; Unit,&#10;    isAdmin: Boolean = false,&#10;    viewModel: HistoryViewModel = hiltViewModel()&#10;) {&#10;    val uiState by viewModel.detailUiState.collectAsState()&#10;    val listUiState by viewModel.uiState.collectAsState()&#10;    val toastMessage by viewModel.toastMessage.collectAsState()&#10;    val currency = remember { NumberFormat.getCurrencyInstance(Locale(&quot;id&quot;, &quot;ID&quot;)).apply { maximumFractionDigits = 0 } }&#10;    val dateFormatter = remember { SimpleDateFormat(&quot;dd MMM yyyy, HH:mm&quot;, Locale(&quot;id&quot;, &quot;ID&quot;)) }&#10;    val snackbarHostState = remember { SnackbarHostState() }&#10;    val scope = rememberCoroutineScope()&#10;&#10;    LaunchedEffect(transactionId) { viewModel.onEvent(HistoryEvent.LoadDetail(transactionId)) }&#10;&#10;    // Show toast message&#10;    LaunchedEffect(toastMessage) {&#10;        toastMessage?.let { message -&gt;&#10;            snackbarHostState.showSnackbar(&#10;                message = message,&#10;                duration = SnackbarDuration.Short&#10;            )&#10;            viewModel.onEvent(HistoryEvent.DismissToast)&#10;        }&#10;    }&#10;&#10;    // Delete confirmation dialog&#10;    if (listUiState.showDeleteDialog) {&#10;        AlertDialog(&#10;            onDismissRequest = { viewModel.onEvent(HistoryEvent.DismissDeleteConfirmation) },&#10;            title = { Text(&quot;Hapus Transaksi?&quot;) },&#10;            text = { Text(&quot;Transaksi yang dihapus tidak dapat dikembalikan. Apakah Anda yakin ingin menghapus transaksi ini?&quot;) },&#10;            confirmButton = {&#10;                Button(&#10;                    onClick = {&#10;                        viewModel.onEvent(HistoryEvent.ConfirmDelete)&#10;                        onDelete(uiState.transaction!!)&#10;                    },&#10;                    colors = ButtonDefaults.buttonColors(&#10;                        containerColor = MaterialTheme.colorScheme.error&#10;                    )&#10;                ) {&#10;                    Text(&quot;Hapus&quot;)&#10;                }&#10;            },&#10;            dismissButton = {&#10;                TextButton(onClick = { viewModel.onEvent(HistoryEvent.DismissDeleteConfirmation) }) {&#10;                    Text(&quot;Batal&quot;)&#10;                }&#10;            }&#10;        )&#10;    }&#10;&#10;    Scaffold(&#10;        topBar = {&#10;            TopAppBar(&#10;                title = { Text(&quot;Detil Transaksi&quot;) },&#10;                navigationIcon = {&#10;                    IconButton(onClick = onBack) { Icon(Icons.AutoMirrored.Filled.ArrowBack, contentDescription = null) }&#10;                }&#10;            )&#10;        },&#10;        snackbarHost = { SnackbarHost(snackbarHostState) }&#10;    ) { padding -&gt;&#10;        if (uiState.isLoading) {&#10;            Box(Modifier.fillMaxSize().padding(padding), contentAlignment = Alignment.Center) { CircularProgressIndicator() }&#10;        } else uiState.transaction?.let { tx -&gt;&#10;            LazyColumn(&#10;                modifier = Modifier.fillMaxSize().padding(padding),&#10;                contentPadding = PaddingValues(16.dp),&#10;                verticalArrangement = Arrangement.spacedBy(12.dp)&#10;            ) {&#10;                item {&#10;                    Text(tx.transactionNumber, style = MaterialTheme.typography.titleLarge, fontWeight = FontWeight.Bold)&#10;                    Text(&quot;Tanggal: ${dateFormatter.format(Date(tx.updatedAt))}&quot;)&#10;                    Text(&quot;Kasir: ${tx.cashierName}&quot;)&#10;                    Text(&quot;Status: ${tx.status.name}&quot;)&#10;                    Text(&quot;Metode Bayar: ${tx.paymentMethod.name}&quot;)&#10;                    HorizontalDivider()&#10;                }&#10;                // Items header&#10;                if (uiState.items.isNotEmpty()) {&#10;                    item {&#10;                        Row(&#10;                            modifier = Modifier.fillMaxWidth(),&#10;                            horizontalArrangement = Arrangement.SpaceBetween,&#10;                            verticalAlignment = Alignment.CenterVertically&#10;                        ) {&#10;                            Text(&quot;Item Dibeli&quot;, style = MaterialTheme.typography.titleMedium)&#10;                            Text(&#10;                                &quot;${uiState.items.size} item • ${uiState.items.sumOf { it.quantity }} pcs&quot;,&#10;                                style = MaterialTheme.typography.bodySmall,&#10;                                color = MaterialTheme.colorScheme.onSurfaceVariant&#10;                            )&#10;                        }&#10;                    }&#10;                    items(uiState.items) { item -&gt;&#10;                        ItemDetailRow(&#10;                            name = item.productName,&#10;                            quantity = item.quantity,&#10;                            unitPrice = item.unitPrice,&#10;                            discount = item.discount,&#10;                            subtotal = item.subtotal,&#10;                            currency = currency&#10;                        )&#10;                    }&#10;                    item { HorizontalDivider() }&#10;                } else {&#10;                    item { Text(&quot;Tidak ada item&quot;, style = MaterialTheme.typography.bodyMedium) }&#10;                }&#10;                // Totals section&#10;                item {&#10;                    val subtotalStr = currency.format(tx.subtotal).replace(&quot;Rp&quot;, &quot;Rp &quot;)&#10;                    val taxStr = currency.format(tx.tax).replace(&quot;Rp&quot;, &quot;Rp &quot;)&#10;                    val discountStr = currency.format(tx.discount).replace(&quot;Rp&quot;, &quot;Rp &quot;)&#10;                    val totalStr = currency.format(tx.total).replace(&quot;Rp&quot;, &quot;Rp &quot;)&#10;                    Column(verticalArrangement = Arrangement.spacedBy(4.dp)) {&#10;                        Text(&quot;Subtotal: $subtotalStr&quot;)&#10;                        if (tx.tax &gt; 0) Text(&quot;PPN: $taxStr&quot;)&#10;                        if (tx.discount &gt; 0) Text(&quot;Diskon: -$discountStr&quot;)&#10;                        Text(&quot;Total: $totalStr&quot;, fontWeight = FontWeight.Bold)&#10;                        if (tx.cashReceived &gt; 0) {&#10;                            val receivedStr = currency.format(tx.cashReceived).replace(&quot;Rp&quot;, &quot;Rp &quot;)&#10;                            val changeStr = currency.format(tx.cashChange).replace(&quot;Rp&quot;, &quot;Rp &quot;)&#10;                            Text(&quot;Dibayar: $receivedStr&quot;)&#10;                            Text(&quot;Kembalian: $changeStr&quot;)&#10;                        }&#10;                    }&#10;                    HorizontalDivider()&#10;                }&#10;                // Actions - improved with Share button and Admin-only Delete&#10;                item {&#10;                    Column(verticalArrangement = Arrangement.spacedBy(8.dp)) {&#10;                        Row(horizontalArrangement = Arrangement.spacedBy(8.dp)) {&#10;                            Button(onClick = {&#10;                                onPrint(tx)&#10;                                scope.launch {&#10;                                    snackbarHostState.showSnackbar(&quot;Struk berhasil dicetak&quot;)&#10;                                }&#10;                            }, modifier = Modifier.weight(1f)) {&#10;                                Icon(Icons.Default.Print, contentDescription = null)&#10;                                Spacer(Modifier.width(6.dp))&#10;                                Text(&quot;Cetak&quot;)&#10;                            }&#10;                            Button(onClick = {&#10;                                onShare(tx)&#10;                                scope.launch {&#10;                                    snackbarHostState.showSnackbar(&quot;Struk berhasil dibagikan&quot;)&#10;                                }&#10;                            }, modifier = Modifier.weight(1f)) {&#10;                                Icon(Icons.Default.Share, contentDescription = null)&#10;                                Spacer(Modifier.width(6.dp))&#10;                                Text(&quot;Bagikan&quot;)&#10;                            }&#10;                        }&#10;                        // Delete button - only for Admin&#10;                        if (isAdmin) {&#10;                            OutlinedButton(&#10;                                onClick = { viewModel.onEvent(HistoryEvent.ShowDeleteConfirmation(tx.id)) },&#10;                                modifier = Modifier.fillMaxWidth(),&#10;                                colors = ButtonDefaults.outlinedButtonColors(contentColor = MaterialTheme.colorScheme.error)&#10;                            ) {&#10;                                Icon(Icons.Default.Delete, contentDescription = null)&#10;                                Spacer(Modifier.width(6.dp))&#10;                                Text(&quot;Hapus Transaksi (Admin)&quot;)&#10;                            }&#10;                        }&#10;                    }&#10;                }&#10;                // Bottom spacing&#10;                item { Spacer(Modifier.height(32.dp)) }&#10;            }&#10;        }&#10;    }&#10;}&#10;&#10;@Composable&#10;private fun ItemDetailRow(&#10;    name: String,&#10;    quantity: Int,&#10;    unitPrice: Double,&#10;    discount: Double,&#10;    subtotal: Double,&#10;    currency: NumberFormat&#10;) {&#10;    ElevatedCard {&#10;        Column(Modifier.fillMaxWidth().padding(12.dp), verticalArrangement = Arrangement.spacedBy(4.dp)) {&#10;            Text(name, style = MaterialTheme.typography.bodyMedium, fontWeight = FontWeight.SemiBold)&#10;            val unitStr = currency.format(unitPrice).replace(&quot;Rp&quot;, &quot;Rp &quot;)&#10;            val subStr = currency.format(subtotal).replace(&quot;Rp&quot;, &quot;Rp &quot;)&#10;            Text(&quot;$quantity x $unitStr = $subStr&quot;, style = MaterialTheme.typography.bodySmall)&#10;            if (discount &gt; 0) {&#10;                val discountStr = currency.format(discount).replace(&quot;Rp&quot;, &quot;Rp &quot;)&#10;                Text(&quot;Diskon item: -$discountStr&quot;, style = MaterialTheme.typography.bodySmall, color = MaterialTheme.colorScheme.primary)&#10;            }&#10;        }&#10;    }&#10;}&#10;&#10;enum class DateRange(val label: String) {&#10;    TODAY(&quot;Hari ini&quot;),&#10;    YESTERDAY(&quot;Kemarin&quot;),&#10;    LAST_7_DAYS(&quot;7 hari terakhir&quot;),&#10;    THIS_MONTH(&quot;Bulan ini&quot;),&#10;    LAST_MONTH(&quot;Bulan lalu&quot;),&#10;    CUSTOM(&quot;Custom&quot;)&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/id/stargan/intikasir/feature/history/ui/components/DateRangePicker.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/id/stargan/intikasir/feature/history/ui/components/DateRangePicker.kt" />
              <option name="updatedContent" value="package id.stargan.intikasir.feature.history.ui.components&#10;&#10;import androidx.compose.material3.*&#10;import androidx.compose.runtime.*&#10;import androidx.compose.ui.Modifier&#10;import java.text.SimpleDateFormat&#10;import java.util.*&#10;&#10;@OptIn(ExperimentalMaterial3Api::class)&#10;@Composable&#10;fun DateRangePickerModal(&#10;    showDialog: Boolean,&#10;    onDismiss: () -&gt; Unit,&#10;    onDateRangeSelected: (Long, Long) -&gt; Unit&#10;) {&#10;    if (showDialog) {&#10;        val dateRangePickerState = rememberDateRangePickerState()&#10;        &#10;        DatePickerDialog(&#10;            onDismissRequest = onDismiss,&#10;            confirmButton = {&#10;                TextButton(&#10;                    onClick = {&#10;                        val startDate = dateRangePickerState.selectedStartDateMillis&#10;                        val endDate = dateRangePickerState.selectedEndDateMillis&#10;                        if (startDate != null &amp;&amp; endDate != null) {&#10;                            onDateRangeSelected(startDate, endDate)&#10;                        }&#10;                        onDismiss()&#10;                    },&#10;                    enabled = dateRangePickerState.selectedStartDateMillis != null &amp;&amp; &#10;                             dateRangePickerState.selectedEndDateMillis != null&#10;                ) {&#10;                    Text(&quot;OK&quot;)&#10;                }&#10;            },&#10;            dismissButton = {&#10;                TextButton(onClick = onDismiss) {&#10;                    Text(&quot;Batal&quot;)&#10;                }&#10;            }&#10;        ) {&#10;            DateRangePicker(&#10;                state = dateRangePickerState,&#10;                modifier = Modifier&#10;            )&#10;        }&#10;    }&#10;}&#10;&#10;fun formatDateRange(startDate: Long, endDate: Long): String {&#10;    val formatter = SimpleDateFormat(&quot;dd MMM yyyy&quot;, Locale(&quot;id&quot;, &quot;ID&quot;))&#10;    return &quot;${formatter.format(Date(startDate))} - ${formatter.format(Date(endDate))}&quot;&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/id/stargan/intikasir/feature/history/util/ExportUtil.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/id/stargan/intikasir/feature/history/util/ExportUtil.kt" />
              <option name="originalContent" value="&#10;" />
              <option name="updatedContent" value="package id.stargan.intikasir.feature.history.util&#10;&#10;import android.content.Context&#10;import android.content.Intent&#10;import androidx.core.content.FileProvider&#10;import id.stargan.intikasir.data.local.entity.TransactionEntity&#10;import id.stargan.intikasir.data.local.entity.TransactionItemEntity&#10;import java.io.File&#10;import java.text.NumberFormat&#10;import java.text.SimpleDateFormat&#10;import java.util.*&#10;&#10;object ExportUtil {&#10;    &#10;    fun exportToCSV(&#10;        context: Context,&#10;        transactions: List&lt;TransactionEntity&gt;,&#10;        itemsMap: Map&lt;String, List&lt;TransactionItemEntity&gt;&gt;&#10;    ): File {&#10;        val dateFormat = SimpleDateFormat(&quot;yyyyMMdd_HHmmss&quot;, Locale.getDefault())&#10;        val fileName = &quot;Transaksi_${dateFormat.format(Date())}.csv&quot;&#10;        val file = File(context.cacheDir, fileName)&#10;        &#10;        val dateFormatter = SimpleDateFormat(&quot;dd/MM/yyyy HH:mm&quot;, Locale(&quot;id&quot;, &quot;ID&quot;))&#10;        &#10;        file.bufferedWriter().use { writer -&gt;&#10;            // Header&#10;            writer.write(&quot;No Transaksi,Tanggal,Kasir,Status,Metode Bayar,Subtotal,PPN,Diskon,Total,Dibayar,Kembalian,Jumlah Item\n&quot;)&#10;            &#10;            // Data&#10;            transactions.forEach { tx -&gt;&#10;                val itemCount = itemsMap[tx.id]?.size ?: 0&#10;                writer.write(&quot;${tx.transactionNumber},&quot;)&#10;                writer.write(&quot;${dateFormatter.format(Date(tx.transactionDate))},&quot;)&#10;                writer.write(&quot;${tx.cashierName},&quot;)&#10;                writer.write(&quot;${tx.status.name},&quot;)&#10;                writer.write(&quot;${tx.paymentMethod.name},&quot;)&#10;                writer.write(&quot;${tx.subtotal},&quot;)&#10;                writer.write(&quot;${tx.tax},&quot;)&#10;                writer.write(&quot;${tx.discount},&quot;)&#10;                writer.write(&quot;${tx.total},&quot;)&#10;                writer.write(&quot;${tx.cashReceived},&quot;)&#10;                writer.write(&quot;${tx.cashChange},&quot;)&#10;                writer.write(&quot;$itemCount\n&quot;)&#10;            }&#10;        }&#10;        &#10;        return file&#10;    }&#10;    &#10;    fun exportDetailedToCSV(&#10;        context: Context,&#10;        transactions: List&lt;TransactionEntity&gt;,&#10;        itemsMap: Map&lt;String, List&lt;TransactionItemEntity&gt;&gt;&#10;    ): File {&#10;        val dateFormat = SimpleDateFormat(&quot;yyyyMMdd_HHmmss&quot;, Locale.getDefault())&#10;        val fileName = &quot;Transaksi_Detail_${dateFormat.format(Date())}.csv&quot;&#10;        val file = File(context.cacheDir, fileName)&#10;        &#10;        val dateFormatter = SimpleDateFormat(&quot;dd/MM/yyyy HH:mm&quot;, Locale(&quot;id&quot;, &quot;ID&quot;))&#10;        &#10;        file.bufferedWriter().use { writer -&gt;&#10;            // Header - Format: No Transaksi → Detail per item&#10;            writer.write(&quot;No Transaksi,Tanggal,Kasir,Status,Metode Bayar,Produk,Qty,Harga Satuan,Diskon Item,Subtotal Item,Total Transaksi\n&quot;)&#10;            &#10;            // Data - Satu baris per item&#10;            transactions.forEach { tx -&gt;&#10;                val items = itemsMap[tx.id] ?: emptyList()&#10;                &#10;                if (items.isEmpty()) {&#10;                    // Jika tidak ada item, tetap tampilkan transaksi&#10;                    writer.write(&quot;${tx.transactionNumber},&quot;)&#10;                    writer.write(&quot;${dateFormatter.format(Date(tx.transactionDate))},&quot;)&#10;                    writer.write(&quot;${tx.cashierName},&quot;)&#10;                    writer.write(&quot;${tx.status.name},&quot;)&#10;                    writer.write(&quot;${tx.paymentMethod.name},&quot;)&#10;                    writer.write(&quot;-,0,0,0,0,&quot;)&#10;                    writer.write(&quot;${tx.total}\n&quot;)&#10;                } else {&#10;                    // Setiap item mendapat baris tersendiri dengan nomor transaksi yang sama&#10;                    items.forEach { item -&gt;&#10;                        writer.write(&quot;${tx.transactionNumber},&quot;)&#10;                        writer.write(&quot;${dateFormatter.format(Date(tx.transactionDate))},&quot;)&#10;                        writer.write(&quot;${tx.cashierName},&quot;)&#10;                        writer.write(&quot;${tx.status.name},&quot;)&#10;                        writer.write(&quot;${tx.paymentMethod.name},&quot;)&#10;                        writer.write(&quot;\&quot;${item.productName.replace(&quot;\&quot;&quot;, &quot;\&quot;\&quot;&quot;)}\&quot;,&quot;) // Escape double quotes&#10;                        writer.write(&quot;${item.quantity},&quot;)&#10;                        writer.write(&quot;${item.unitPrice},&quot;)&#10;                        writer.write(&quot;${item.discount},&quot;)&#10;                        writer.write(&quot;${item.subtotal},&quot;)&#10;                        writer.write(&quot;${tx.total}\n&quot;)&#10;                    }&#10;                }&#10;            }&#10;        }&#10;        &#10;        return file&#10;    }&#10;    &#10;    fun shareCSV(context: Context, file: File) {&#10;        val uri = FileProvider.getUriForFile(&#10;            context,&#10;            &quot;${context.packageName}.fileprovider&quot;,&#10;            file&#10;        )&#10;        &#10;        val intent = Intent(Intent.ACTION_SEND).apply {&#10;            type = &quot;text/csv&quot;&#10;            putExtra(Intent.EXTRA_STREAM, uri)&#10;            addFlags(Intent.FLAG_GRANT_READ_URI_PERMISSION)&#10;        }&#10;        &#10;        context.startActivity(&#10;            Intent.createChooser(intent, &quot;Bagikan Laporan&quot;)&#10;                .addFlags(Intent.FLAG_ACTIVITY_NEW_TASK)&#10;        )&#10;    }&#10;}&#10;&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/id/stargan/intikasir/feature/history/viewmodel/HistoryViewModel.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/id/stargan/intikasir/feature/history/viewmodel/HistoryViewModel.kt" />
              <option name="originalContent" value="package id.stargan.intikasir.feature.history.viewmodel&#10;&#10;import androidx.lifecycle.ViewModel&#10;import androidx.lifecycle.viewModelScope&#10;import dagger.hilt.android.lifecycle.HiltViewModel&#10;import id.stargan.intikasir.data.local.entity.TransactionEntity&#10;import id.stargan.intikasir.data.local.entity.TransactionItemEntity&#10;import id.stargan.intikasir.feature.pos.domain.TransactionRepository&#10;import kotlinx.coroutines.flow.*&#10;import kotlinx.coroutines.launch&#10;import java.util.*&#10;import javax.inject.Inject&#10;import id.stargan.intikasir.feature.history.ui.DateRange&#10;&#10;@HiltViewModel&#10;class HistoryViewModel @Inject constructor(&#10;    private val repo: TransactionRepository&#10;) : ViewModel() {&#10;&#10;    private val _uiState = MutableStateFlow(HistoryUiState())&#10;    val uiState: StateFlow&lt;HistoryUiState&gt; = _uiState.asStateFlow()&#10;&#10;    private val _detailUiState = MutableStateFlow(HistoryDetailUiState())&#10;    val detailUiState: StateFlow&lt;HistoryDetailUiState&gt; = _detailUiState.asStateFlow()&#10;&#10;    init {&#10;        applyFilter() // default today&#10;    }&#10;&#10;    fun onEvent(event: HistoryEvent) {&#10;        when (event) {&#10;            is HistoryEvent.ChangeRange -&gt; _uiState.update { it.copy(range = event.range, showFilter = true).withRangeDefaults() }&#10;            is HistoryEvent.ChangeStartDate -&gt; _uiState.update { it.copy(startDate = event.value) }&#10;            is HistoryEvent.ChangeEndDate -&gt; _uiState.update { it.copy(endDate = event.value) }&#10;            HistoryEvent.ApplyFilter -&gt; applyFilter()&#10;            HistoryEvent.ToggleFilter -&gt; _uiState.update { it.copy(showFilter = !it.showFilter) }&#10;            is HistoryEvent.LoadDetail -&gt; loadDetail(event.transactionId)&#10;        }&#10;    }&#10;&#10;    private fun HistoryUiState.withRangeDefaults(): HistoryUiState {&#10;        val cal = Calendar.getInstance()&#10;        val end = cal.timeInMillis&#10;        val start: Long = when (range) {&#10;            DateRange.TODAY -&gt; startOfDay(end)&#10;            DateRange.YESTERDAY -&gt; startOfDay(end - 24*60*60*1000).also { cal.timeInMillis = it }&#10;            DateRange.LAST_7_DAYS -&gt; end - 6*24*60*60*1000&#10;            DateRange.THIS_MONTH -&gt; startOfMonth(end)&#10;            DateRange.LAST_MONTH -&gt; startOfLastMonth(end)&#10;            DateRange.CUSTOM -&gt; startDate&#10;        }&#10;        val newEnd = when (range) {&#10;            DateRange.YESTERDAY -&gt; endOfDay(start)&#10;            else -&gt; end&#10;        }&#10;        return copy(startDate = start, endDate = newEnd)&#10;    }&#10;&#10;    private fun startOfDay(time: Long): Long {&#10;        val cal = Calendar.getInstance().apply { timeInMillis = time; set(Calendar.HOUR_OF_DAY, 0); set(Calendar.MINUTE, 0); set(Calendar.SECOND, 0); set(Calendar.MILLISECOND, 0) }&#10;        return cal.timeInMillis&#10;    }&#10;    private fun endOfDay(time: Long): Long {&#10;        val cal = Calendar.getInstance().apply { timeInMillis = time; set(Calendar.HOUR_OF_DAY, 23); set(Calendar.MINUTE, 59); set(Calendar.SECOND, 59); set(Calendar.MILLISECOND, 999) }&#10;        return cal.timeInMillis&#10;    }&#10;    private fun startOfMonth(time: Long): Long {&#10;        val cal = Calendar.getInstance().apply { timeInMillis = time; set(Calendar.DAY_OF_MONTH, 1); set(Calendar.HOUR_OF_DAY, 0); set(Calendar.MINUTE, 0); set(Calendar.SECOND, 0); set(Calendar.MILLISECOND, 0) }&#10;        return cal.timeInMillis&#10;    }&#10;    private fun startOfLastMonth(time: Long): Long {&#10;        val cal = Calendar.getInstance().apply { timeInMillis = time; add(Calendar.MONTH, -1); set(Calendar.DAY_OF_MONTH, 1); set(Calendar.HOUR_OF_DAY, 0); set(Calendar.MINUTE, 0); set(Calendar.SECOND, 0); set(Calendar.MILLISECOND, 0) }&#10;        return cal.timeInMillis&#10;    }&#10;&#10;    private fun applyFilter() {&#10;        val s = _uiState.value&#10;        _uiState.update { it.copy(isLoading = true) }&#10;        viewModelScope.launch {&#10;            repo.getTransactionsByDateRange(s.startDate, s.endDate, onlyCompleted = true).collect { list -&gt;&#10;                _uiState.update { it.copy(isLoading = false, transactions = list) }&#10;            }&#10;        }&#10;    }&#10;&#10;    private fun loadDetail(transactionId: String) {&#10;        _detailUiState.update { it.copy(isLoading = true) }&#10;        viewModelScope.launch {&#10;            combine(&#10;                repo.getTransactionById(transactionId),&#10;                repo.getTransactionItems(transactionId)&#10;            ) { tx, items -&gt; tx to items }&#10;                .collect { (tx, items) -&gt;&#10;                    _detailUiState.update { it.copy(isLoading = false, transaction = tx, items = items) }&#10;                }&#10;        }&#10;    }&#10;&#10;    fun deleteTransaction(transactionId: String) {&#10;        viewModelScope.launch { repo.softDeleteTransaction(transactionId) }&#10;    }&#10;}&#10;&#10;data class HistoryUiState(&#10;    val isLoading: Boolean = false,&#10;    val transactions: List&lt;TransactionEntity&gt; = emptyList(),&#10;    val showFilter: Boolean = false,&#10;    val range: DateRange = DateRange.TODAY,&#10;    val startDate: Long = Calendar.getInstance().let { cal -&gt; cal.set(Calendar.HOUR_OF_DAY, 0); cal.set(Calendar.MINUTE, 0); cal.set(Calendar.SECOND, 0); cal.set(Calendar.MILLISECOND, 0); cal.timeInMillis },&#10;    val endDate: Long = System.currentTimeMillis()&#10;)&#10;&#10;data class HistoryDetailUiState(&#10;    val isLoading: Boolean = false,&#10;    val transaction: TransactionEntity? = null,&#10;    val items: List&lt;TransactionItemEntity&gt; = emptyList()&#10;)&#10;&#10;sealed class HistoryEvent {&#10;    data class ChangeRange(val range: DateRange) : HistoryEvent()&#10;    data class ChangeStartDate(val value: Long) : HistoryEvent()&#10;    data class ChangeEndDate(val value: Long) : HistoryEvent()&#10;    data object ApplyFilter : HistoryEvent()&#10;    data object ToggleFilter : HistoryEvent()&#10;    data class LoadDetail(val transactionId: String) : HistoryEvent()&#10;}&#10;" />
              <option name="updatedContent" value="package id.stargan.intikasir.feature.history.viewmodel&#10;&#10;import androidx.lifecycle.ViewModel&#10;import androidx.lifecycle.viewModelScope&#10;import dagger.hilt.android.lifecycle.HiltViewModel&#10;import id.stargan.intikasir.data.local.entity.TransactionEntity&#10;import id.stargan.intikasir.data.local.entity.TransactionItemEntity&#10;import id.stargan.intikasir.data.local.entity.TransactionStatus&#10;import id.stargan.intikasir.feature.pos.domain.TransactionRepository&#10;import kotlinx.coroutines.flow.*&#10;import kotlinx.coroutines.launch&#10;import java.util.*&#10;import javax.inject.Inject&#10;import id.stargan.intikasir.feature.history.ui.DateRange&#10;&#10;@HiltViewModel&#10;class HistoryViewModel @Inject constructor(&#10;    private val repo: TransactionRepository&#10;) : ViewModel() {&#10;&#10;    private val _uiState = MutableStateFlow(HistoryUiState())&#10;    val uiState: StateFlow&lt;HistoryUiState&gt; = _uiState.asStateFlow()&#10;&#10;    private val _detailUiState = MutableStateFlow(HistoryDetailUiState())&#10;    val detailUiState: StateFlow&lt;HistoryDetailUiState&gt; = _detailUiState.asStateFlow()&#10;&#10;    private val _toastMessage = MutableStateFlow&lt;String?&gt;(null)&#10;    val toastMessage: StateFlow&lt;String?&gt; = _toastMessage.asStateFlow()&#10;&#10;    init {&#10;        applyFilter() // default today&#10;    }&#10;&#10;    fun onEvent(event: HistoryEvent) {&#10;        when (event) {&#10;            is HistoryEvent.ChangeRange -&gt; _uiState.update { it.copy(range = event.range, showFilter = true).withRangeDefaults() }&#10;            is HistoryEvent.ChangeStartDate -&gt; _uiState.update { it.copy(startDate = event.value) }&#10;            is HistoryEvent.ChangeEndDate -&gt; _uiState.update { it.copy(endDate = event.value) }&#10;            is HistoryEvent.ChangeStatus -&gt; _uiState.update { it.copy(selectedStatus = event.status) }&#10;            HistoryEvent.ApplyFilter -&gt; applyFilter()&#10;            HistoryEvent.ToggleFilter -&gt; _uiState.update { it.copy(showFilter = !it.showFilter) }&#10;            is HistoryEvent.LoadDetail -&gt; loadDetail(event.transactionId)&#10;            is HistoryEvent.ShowDeleteConfirmation -&gt; _uiState.update { it.copy(showDeleteDialog = true, transactionToDelete = event.transactionId) }&#10;            HistoryEvent.DismissDeleteConfirmation -&gt; _uiState.update { it.copy(showDeleteDialog = false, transactionToDelete = null) }&#10;            HistoryEvent.ConfirmDelete -&gt; confirmDelete()&#10;            HistoryEvent.DismissToast -&gt; _toastMessage.value = null&#10;        }&#10;    }&#10;&#10;    private fun HistoryUiState.withRangeDefaults(): HistoryUiState {&#10;        val cal = Calendar.getInstance()&#10;        val end = cal.timeInMillis&#10;        val start: Long = when (range) {&#10;            DateRange.TODAY -&gt; startOfDay(end)&#10;            DateRange.YESTERDAY -&gt; startOfDay(end - 24*60*60*1000).also { cal.timeInMillis = it }&#10;            DateRange.LAST_7_DAYS -&gt; end - 6*24*60*60*1000&#10;            DateRange.THIS_MONTH -&gt; startOfMonth(end)&#10;            DateRange.LAST_MONTH -&gt; startOfLastMonth(end)&#10;            DateRange.CUSTOM -&gt; startDate&#10;        }&#10;        val newEnd = when (range) {&#10;            DateRange.YESTERDAY -&gt; endOfDay(start)&#10;            else -&gt; end&#10;        }&#10;        return copy(startDate = start, endDate = newEnd)&#10;    }&#10;&#10;    private fun startOfDay(time: Long): Long {&#10;        val cal = Calendar.getInstance().apply { timeInMillis = time; set(Calendar.HOUR_OF_DAY, 0); set(Calendar.MINUTE, 0); set(Calendar.SECOND, 0); set(Calendar.MILLISECOND, 0) }&#10;        return cal.timeInMillis&#10;    }&#10;    private fun endOfDay(time: Long): Long {&#10;        val cal = Calendar.getInstance().apply { timeInMillis = time; set(Calendar.HOUR_OF_DAY, 23); set(Calendar.MINUTE, 59); set(Calendar.SECOND, 59); set(Calendar.MILLISECOND, 999) }&#10;        return cal.timeInMillis&#10;    }&#10;    private fun startOfMonth(time: Long): Long {&#10;        val cal = Calendar.getInstance().apply { timeInMillis = time; set(Calendar.DAY_OF_MONTH, 1); set(Calendar.HOUR_OF_DAY, 0); set(Calendar.MINUTE, 0); set(Calendar.SECOND, 0); set(Calendar.MILLISECOND, 0) }&#10;        return cal.timeInMillis&#10;    }&#10;    private fun startOfLastMonth(time: Long): Long {&#10;        val cal = Calendar.getInstance().apply { timeInMillis = time; add(Calendar.MONTH, -1); set(Calendar.DAY_OF_MONTH, 1); set(Calendar.HOUR_OF_DAY, 0); set(Calendar.MINUTE, 0); set(Calendar.SECOND, 0); set(Calendar.MILLISECOND, 0) }&#10;        return cal.timeInMillis&#10;    }&#10;&#10;    private fun applyFilter() {&#10;        val s = _uiState.value&#10;        _uiState.update { it.copy(isLoading = true) }&#10;        viewModelScope.launch {&#10;            repo.getTransactionsByDateRange(s.startDate, s.endDate, onlyCompleted = false).collect { list -&gt;&#10;                val filtered = if (s.selectedStatus != null) {&#10;                    list.filter { it.status == s.selectedStatus }&#10;                } else {&#10;                    list&#10;                }&#10;                _uiState.update { it.copy(isLoading = false, transactions = filtered) }&#10;            }&#10;        }&#10;    }&#10;&#10;    private fun confirmDelete() {&#10;        val txId = _uiState.value.transactionToDelete ?: return&#10;        viewModelScope.launch {&#10;            repo.softDeleteTransaction(txId)&#10;            _uiState.update { it.copy(showDeleteDialog = false, transactionToDelete = null) }&#10;            _toastMessage.value = &quot;Transaksi berhasil dihapus&quot;&#10;        }&#10;    }&#10;&#10;    private fun loadDetail(transactionId: String) {&#10;        _detailUiState.update { it.copy(isLoading = true) }&#10;        viewModelScope.launch {&#10;            combine(&#10;                repo.getTransactionById(transactionId),&#10;                repo.getTransactionItems(transactionId)&#10;            ) { tx, items -&gt; tx to items }&#10;                .collect { (tx, items) -&gt;&#10;                    _detailUiState.update { it.copy(isLoading = false, transaction = tx, items = items) }&#10;                }&#10;        }&#10;    }&#10;&#10;    fun deleteTransaction(transactionId: String) {&#10;        viewModelScope.launch { repo.softDeleteTransaction(transactionId) }&#10;    }&#10;&#10;    suspend fun loadAllTransactionItems(transactionIds: List&lt;String&gt;): Map&lt;String, List&lt;TransactionItemEntity&gt;&gt; {&#10;        val itemsMap = mutableMapOf&lt;String, List&lt;TransactionItemEntity&gt;&gt;()&#10;        transactionIds.forEach { txId -&gt;&#10;            val items = repo.getTransactionItems(txId).first()&#10;            itemsMap[txId] = items&#10;        }&#10;        return itemsMap&#10;    }&#10;}&#10;&#10;data class HistoryUiState(&#10;    val isLoading: Boolean = false,&#10;    val transactions: List&lt;TransactionEntity&gt; = emptyList(),&#10;    val showFilter: Boolean = false,&#10;    val range: DateRange = DateRange.TODAY,&#10;    val startDate: Long = Calendar.getInstance().let { cal -&gt; cal.set(Calendar.HOUR_OF_DAY, 0); cal.set(Calendar.MINUTE, 0); cal.set(Calendar.SECOND, 0); cal.set(Calendar.MILLISECOND, 0); cal.timeInMillis },&#10;    val endDate: Long = System.currentTimeMillis(),&#10;    val selectedStatus: TransactionStatus? = null,&#10;    val showDeleteDialog: Boolean = false,&#10;    val transactionToDelete: String? = null&#10;)&#10;&#10;data class HistoryDetailUiState(&#10;    val isLoading: Boolean = false,&#10;    val transaction: TransactionEntity? = null,&#10;    val items: List&lt;TransactionItemEntity&gt; = emptyList()&#10;)&#10;&#10;sealed class HistoryEvent {&#10;    data class ChangeRange(val range: DateRange) : HistoryEvent()&#10;    data class ChangeStartDate(val value: Long) : HistoryEvent()&#10;    data class ChangeEndDate(val value: Long) : HistoryEvent()&#10;    data class ChangeStatus(val status: TransactionStatus?) : HistoryEvent()&#10;    data object ApplyFilter : HistoryEvent()&#10;    data object ToggleFilter : HistoryEvent()&#10;    data class LoadDetail(val transactionId: String) : HistoryEvent()&#10;    data class ShowDeleteConfirmation(val transactionId: String) : HistoryEvent()&#10;    data object DismissDeleteConfirmation : HistoryEvent()&#10;    data object ConfirmDelete : HistoryEvent()&#10;    data object DismissToast : HistoryEvent()&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/id/stargan/intikasir/feature/home/navigation/HomeNavGraph.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/id/stargan/intikasir/feature/home/navigation/HomeNavGraph.kt" />
              <option name="originalContent" value="package id.stargan.intikasir.feature.home.navigation&#10;&#10;import androidx.compose.foundation.layout.*&#10;import androidx.compose.material.icons.Icons&#10;import androidx.compose.material.icons.automirrored.filled.ArrowBack&#10;import androidx.compose.material.icons.filled.Share&#10;import androidx.compose.material3.*&#10;import androidx.compose.runtime.Composable&#10;import androidx.compose.runtime.LaunchedEffect&#10;import androidx.compose.runtime.collectAsState&#10;import androidx.compose.runtime.getValue&#10;import androidx.compose.runtime.remember&#10;import androidx.compose.runtime.rememberCoroutineScope&#10;import androidx.compose.ui.Alignment&#10;import androidx.compose.ui.Modifier&#10;import androidx.compose.ui.text.style.TextAlign&#10;import androidx.navigation.NavController&#10;import androidx.navigation.NavGraphBuilder&#10;import androidx.navigation.NavType&#10;import androidx.navigation.navArgument&#10;import androidx.navigation.compose.composable&#10;import androidx.navigation.compose.navigation&#10;import androidx.hilt.navigation.compose.hiltViewModel&#10;import dagger.hilt.android.lifecycle.HiltViewModel&#10;import id.stargan.intikasir.feature.home.ui.HomeScreen&#10;import id.stargan.intikasir.feature.product.ui.list.ProductListScreen&#10;import id.stargan.intikasir.feature.product.navigation.ProductRoutes&#10;import id.stargan.intikasir.feature.settings.ui.StoreSettingsScreen&#10;import id.stargan.intikasir.feature.settings.ui.StoreSettingsViewModel&#10;import id.stargan.intikasir.feature.pos.ui.PosScreenReactive&#10;import id.stargan.intikasir.feature.pos.ui.cart.CartScreenReactive&#10;import id.stargan.intikasir.feature.pos.ui.payment.PaymentScreenReactive&#10;import id.stargan.intikasir.feature.pos.ui.receipt.ReceiptScreen&#10;import id.stargan.intikasir.feature.pos.navigation.PosRoutes&#10;import id.stargan.intikasir.feature.pos.print.ReceiptPrinter&#10;import id.stargan.intikasir.feature.pos.print.ESCPosPrinter&#10;import id.stargan.intikasir.feature.history.ui.HistoryScreen&#10;import id.stargan.intikasir.feature.history.ui.HistoryDetailScreen&#10;import id.stargan.intikasir.feature.auth.domain.usecase.GetCurrentUserUseCase&#10;import id.stargan.intikasir.domain.model.UserRole&#10;import javax.inject.Inject&#10;import kotlinx.coroutines.launch&#10;import androidx.lifecycle.ViewModel&#10;&#10;/**&#10; * Navigation graph untuk Home feature&#10; */&#10;fun NavGraphBuilder.homeNavGraph(&#10;    navController: NavController,&#10;    onLogout: () -&gt; Unit&#10;) {&#10;    composable(HomeRoutes.HOME) {&#10;        HomeScreen(&#10;            onMenuClick = { route -&gt;&#10;                if (route == &quot;cashier&quot;) {&#10;                    // Navigate to cashier route with optional transactionId param omitted&#10;                    navController.navigate(PosRoutes.POS)&#10;                } else {&#10;                    navController.navigate(route)&#10;                }&#10;            },&#10;            onLogout = onLogout&#10;        )&#10;    }&#10;&#10;    // Product List Screen&#10;    composable(HomeRoutes.PRODUCTS) {&#10;        ProductListScreen(&#10;            onProductClick = { productId -&gt;&#10;                navController.navigate(ProductRoutes.productDetail(productId))&#10;            },&#10;            onAddProductClick = {&#10;                navController.navigate(ProductRoutes.PRODUCT_ADD)&#10;            },&#10;            onManageCategoriesClick = {&#10;                navController.navigate(ProductRoutes.CATEGORY_MANAGE)&#10;            },&#10;            onBackClick = { navController.navigateUp() }&#10;        )&#10;    }&#10;&#10;    // Product Detail Screen (Placeholder)&#10;    composable(ProductRoutes.PRODUCT_DETAIL) {&#10;        PlaceholderScreen(title = &quot;Detail Produk&quot;, onBack = { navController.navigateUp() })&#10;    }&#10;&#10;    // Product Add Screen (Placeholder)&#10;    composable(ProductRoutes.PRODUCT_ADD) {&#10;        PlaceholderScreen(title = &quot;Tambah Produk&quot;, onBack = { navController.navigateUp() })&#10;    }&#10;&#10;    // Product Edit Screen (Placeholder)&#10;    composable(ProductRoutes.PRODUCT_EDIT) {&#10;        PlaceholderScreen(title = &quot;Edit Produk&quot;, onBack = { navController.navigateUp() })&#10;    }&#10;&#10;    // Category Management Screen (Placeholder)&#10;    composable(ProductRoutes.CATEGORY_MANAGE) {&#10;        PlaceholderScreen(title = &quot;Kelola Kategori&quot;, onBack = { navController.navigateUp() })&#10;    }&#10;&#10;    composable(HomeRoutes.HISTORY) {&#10;        HistoryScreen(&#10;            onBack = { navController.navigateUp() },&#10;            onOpenDetail = { txId -&gt; navController.navigate(&quot;${HomeRoutes.HISTORY}/detail/$txId&quot;) }&#10;        )&#10;    }&#10;&#10;    composable(&quot;${HomeRoutes.HISTORY}/detail/{transactionId}&quot;, arguments = listOf(&#10;        navArgument(&quot;transactionId&quot;) { type = NavType.StringType }&#10;    )) { backStackEntry -&gt;&#10;        val txId = backStackEntry.arguments?.getString(&quot;transactionId&quot;)!!&#10;        val settingsViewModel = hiltViewModel&lt;StoreSettingsViewModel&gt;()&#10;        val settingsState by settingsViewModel.uiState.collectAsState()&#10;        val context = androidx.compose.ui.platform.LocalContext.current&#10;        val scope = rememberCoroutineScope()&#10;        val posVm = hiltViewModel&lt;id.stargan.intikasir.feature.pos.ui.PosViewModelReactive&gt;()&#10;        val historyVm = hiltViewModel&lt;id.stargan.intikasir.feature.history.viewmodel.HistoryViewModel&gt;()&#10;&#10;        // Get current user role using GetCurrentUserUseCase&#10;        val getCurrentUserUseCase: GetCurrentUserUseCase = hiltViewModel&lt;HistoryRoleViewModel&gt;().getCurrentUserUseCase&#10;        val currentUser by getCurrentUserUseCase().collectAsState(initial = null)&#10;&#10;        HistoryDetailScreen(&#10;            transactionId = txId,&#10;            onBack = { navController.navigateUp() },&#10;            onPrint = { tx -&gt;&#10;                scope.launch {&#10;                    posVm.loadTransaction(txId)&#10;                    val items = posVm.uiState.value.transactionItems&#10;                    val settings = settingsState.settings&#10;                    val result = ReceiptPrinter.generateThermalReceiptPdf(context, settings, tx, items)&#10;                    ReceiptPrinter.printOrSave(context, settings, result.pdfUri, result.fileName)&#10;                }&#10;            },&#10;            onShare = { tx -&gt;&#10;                scope.launch {&#10;                    posVm.loadTransaction(txId)&#10;                    val items = posVm.uiState.value.transactionItems&#10;                    val settings = settingsState.settings&#10;                    val result = ReceiptPrinter.generateThermalReceiptPdf(context, settings, tx, items)&#10;                    ReceiptPrinter.sharePdf(context, result.pdfUri)&#10;                }&#10;            },&#10;            onDelete = { tx -&gt;&#10;                scope.launch {&#10;                    historyVm.deleteTransaction(tx.id)&#10;                    navController.navigateUp()&#10;                }&#10;            },&#10;            isAdmin = currentUser?.role == UserRole.ADMIN&#10;        )&#10;    }&#10;&#10;    composable(HomeRoutes.EXPENSES) {&#10;        PlaceholderScreen(title = &quot;Pengeluaran&quot;, onBack = { navController.navigateUp() })&#10;    }&#10;&#10;    composable(HomeRoutes.REPORTS) {&#10;        PlaceholderScreen(title = &quot;Laporan&quot;, onBack = { navController.navigateUp() })&#10;    }&#10;&#10;    composable(HomeRoutes.PRINT_RECEIPT) {&#10;        PlaceholderScreen(title = &quot;Cetak Resi&quot;, onBack = { navController.navigateUp() })&#10;    }&#10;&#10;    // POS Screen (Kasir) - Reactive version&#10;    composable(&#10;        route = PosRoutes.POS_WITH_ID,&#10;        arguments = listOf(&#10;            navArgument(&quot;transactionId&quot;) {&#10;                type = NavType.StringType&#10;                nullable = true&#10;                defaultValue = null&#10;            }&#10;        )&#10;    ) { backStackEntry -&gt;&#10;        val transactionId = backStackEntry.arguments?.getString(&quot;transactionId&quot;)&#10;&#10;        PosScreenReactive(&#10;            transactionId = transactionId,&#10;            onNavigateToCart = { txId -&gt;&#10;                navController.navigate(PosRoutes.cart(txId))&#10;            },&#10;            onNavigateToPayment = { txId -&gt;&#10;                navController.navigate(PosRoutes.payment(txId))&#10;            },&#10;            onNavigateBack = { navController.navigateUp() }&#10;        )&#10;    }&#10;&#10;    // Cart Screen - Reactive version&#10;    composable(&#10;        route = PosRoutes.CART,&#10;        arguments = listOf(&#10;            navArgument(&quot;transactionId&quot;) { type = NavType.StringType }&#10;        )&#10;    ) { backStackEntry -&gt;&#10;        val transactionId = backStackEntry.arguments?.getString(&quot;transactionId&quot;)!!&#10;&#10;        CartScreenReactive(&#10;            transactionId = transactionId,&#10;            onNavigateBack = { navController.navigateUp() },&#10;            onNavigateToPayment = { txId -&gt;&#10;                navController.navigate(PosRoutes.payment(txId))&#10;            }&#10;        )&#10;    }&#10;&#10;    // Payment Screen - Reactive version&#10;    composable(&#10;        route = PosRoutes.PAYMENT,&#10;        arguments = listOf(&#10;            navArgument(&quot;transactionId&quot;) { type = NavType.StringType }&#10;        )&#10;    ) { backStackEntry -&gt;&#10;        val transactionId = backStackEntry.arguments?.getString(&quot;transactionId&quot;)!!&#10;&#10;        PaymentScreenReactive(&#10;            transactionId = transactionId,&#10;            onPaymentSuccess = { txId -&gt;&#10;                navController.navigate(PosRoutes.receipt(txId)) {&#10;                    popUpTo(HomeRoutes.HOME) { inclusive = false }&#10;                }&#10;            },&#10;            onNavigateBack = { navController.navigateUp() }&#10;        )&#10;    }&#10;&#10;    // Receipt Screen&#10;    composable(&#10;        route = PosRoutes.RECEIPT,&#10;        arguments = listOf(&#10;            navArgument(&quot;transactionId&quot;) { type = NavType.StringType }&#10;        )&#10;    ) { backStackEntry -&gt;&#10;        val transactionId = backStackEntry.arguments?.getString(&quot;transactionId&quot;)!!&#10;        val viewModel = hiltViewModel&lt;id.stargan.intikasir.feature.pos.ui.PosViewModelReactive&gt;()&#10;        val settingsViewModel = hiltViewModel&lt;StoreSettingsViewModel&gt;()&#10;        val state by viewModel.uiState.collectAsState()&#10;        val settingsState by settingsViewModel.uiState.collectAsState()&#10;        val context = androidx.compose.ui.platform.LocalContext.current&#10;        val scope = rememberCoroutineScope()&#10;&#10;        // Load transaction for receipt&#10;        LaunchedEffect(transactionId) {&#10;            viewModel.loadTransaction(transactionId)&#10;        }&#10;&#10;        ReceiptScreen(&#10;            transactionNumber = state.transaction?.transactionNumber ?: &quot;INV-XXXXX&quot;,&#10;            total = state.total,&#10;            cashReceived = state.transaction?.cashReceived ?: 0.0,&#10;            cashChange = state.transaction?.cashChange ?: 0.0,&#10;            paymentMethod = state.paymentMethod.name,&#10;            onFinish = {&#10;                navController.navigate(HomeRoutes.HOME) {&#10;                    popUpTo(HomeRoutes.HOME) { inclusive = false }&#10;                }&#10;            },&#10;            onPrint = {&#10;                val tx = state.transaction ?: return@ReceiptScreen&#10;                val items = state.transactionItems&#10;                val settings = settingsState.settings&#10;                if (settings?.useEscPosDirect == true &amp;&amp; !settings.printerAddress.isNullOrBlank()) {&#10;                    ESCPosPrinter.printReceipt(context, settings, tx, items)&#10;                } else {&#10;                    // Thermal PDF&#10;                    val result = ReceiptPrinter.generateThermalReceiptPdf(&#10;                        context = context,&#10;                        settings = settings,&#10;                        transaction = tx,&#10;                        items = items&#10;                    )&#10;                    ReceiptPrinter.printOrSave(&#10;                        context = context,&#10;                        settings = settings,&#10;                        pdfUri = result.pdfUri,&#10;                        jobName = result.fileName&#10;                    )&#10;                }&#10;            },&#10;            onShare = {&#10;                val tx = state.transaction ?: return@ReceiptScreen&#10;                val items = state.transactionItems&#10;                val settings = settingsState.settings&#10;                val result = ReceiptPrinter.generateThermalReceiptPdf(&#10;                    context = context,&#10;                    settings = settings,&#10;                    transaction = tx,&#10;                    items = items&#10;                )&#10;                ReceiptPrinter.sharePdf(context, result.pdfUri)&#10;            },&#10;            onNewTransaction = {&#10;                navController.navigate(PosRoutes.POS) {&#10;                    popUpTo(HomeRoutes.HOME) { inclusive = false }&#10;                }&#10;            }&#10;        )&#10;    }&#10;&#10;    // Store Settings Screen&#10;    composable(HomeRoutes.SETTINGS) {&#10;        StoreSettingsScreen(&#10;            onNavigateBack = { navController.navigateUp() }&#10;        )&#10;    }&#10;}&#10;&#10;/**&#10; * Placeholder screen untuk menu yang belum diimplementasi&#10; */&#10;@OptIn(ExperimentalMaterial3Api::class)&#10;@Composable&#10;fun PlaceholderScreen(&#10;    title: String,&#10;    onBack: () -&gt; Unit&#10;) {&#10;    Scaffold(&#10;        topBar = {&#10;            TopAppBar(&#10;                title = { Text(title) },&#10;                navigationIcon = {&#10;                    IconButton(onClick = onBack) {&#10;                        Icon(&#10;                            imageVector = Icons.AutoMirrored.Filled.ArrowBack,&#10;                            contentDescription = &quot;Back&quot;&#10;                        )&#10;                    }&#10;                }&#10;            )&#10;        }&#10;    ) { paddingValues -&gt;&#10;        Box(&#10;            modifier = Modifier&#10;                .fillMaxSize()&#10;                .padding(paddingValues),&#10;            contentAlignment = Alignment.Center&#10;        ) {&#10;            Text(&#10;                text = &quot;Halaman $title\n(Belum diimplementasi)&quot;,&#10;                style = MaterialTheme.typography.titleLarge,&#10;                textAlign = TextAlign.Center&#10;            )&#10;        }&#10;    }&#10;}&#10;&#10;// Simple ViewModel to expose GetCurrentUserUseCase for navigation&#10;@HiltViewModel&#10;class HistoryRoleViewModel @Inject constructor(&#10;    val getCurrentUserUseCase: GetCurrentUserUseCase&#10;) : ViewModel()&#10;" />
              <option name="updatedContent" value="package id.stargan.intikasir.feature.home.navigation&#10;&#10;import androidx.compose.foundation.layout.*&#10;import androidx.compose.material.icons.Icons&#10;import androidx.compose.material.icons.automirrored.filled.ArrowBack&#10;import androidx.compose.material.icons.filled.Share&#10;import androidx.compose.material3.*&#10;import androidx.compose.runtime.Composable&#10;import androidx.compose.runtime.LaunchedEffect&#10;import androidx.compose.runtime.collectAsState&#10;import androidx.compose.runtime.getValue&#10;import androidx.compose.runtime.remember&#10;import androidx.compose.runtime.rememberCoroutineScope&#10;import androidx.compose.ui.Alignment&#10;import androidx.compose.ui.Modifier&#10;import androidx.compose.ui.text.style.TextAlign&#10;import androidx.navigation.NavController&#10;import androidx.navigation.NavGraphBuilder&#10;import androidx.navigation.NavType&#10;import androidx.navigation.navArgument&#10;import androidx.navigation.compose.composable&#10;import androidx.navigation.compose.navigation&#10;import androidx.hilt.navigation.compose.hiltViewModel&#10;import dagger.hilt.android.lifecycle.HiltViewModel&#10;import id.stargan.intikasir.feature.home.ui.HomeScreen&#10;import id.stargan.intikasir.feature.product.ui.list.ProductListScreen&#10;import id.stargan.intikasir.feature.product.navigation.ProductRoutes&#10;import id.stargan.intikasir.feature.settings.ui.StoreSettingsScreen&#10;import id.stargan.intikasir.feature.settings.ui.StoreSettingsViewModel&#10;import id.stargan.intikasir.feature.pos.ui.PosScreenReactive&#10;import id.stargan.intikasir.feature.pos.ui.cart.CartScreenReactive&#10;import id.stargan.intikasir.feature.pos.ui.payment.PaymentScreenReactive&#10;import id.stargan.intikasir.feature.pos.ui.receipt.ReceiptScreen&#10;import id.stargan.intikasir.feature.pos.navigation.PosRoutes&#10;import id.stargan.intikasir.feature.pos.print.ReceiptPrinter&#10;import id.stargan.intikasir.feature.pos.print.ESCPosPrinter&#10;import id.stargan.intikasir.feature.history.ui.HistoryScreen&#10;import id.stargan.intikasir.feature.history.ui.HistoryDetailScreen&#10;import id.stargan.intikasir.feature.auth.domain.usecase.GetCurrentUserUseCase&#10;import id.stargan.intikasir.domain.model.UserRole&#10;import javax.inject.Inject&#10;import kotlinx.coroutines.launch&#10;import androidx.lifecycle.ViewModel&#10;&#10;/**&#10; * Navigation graph untuk Home feature&#10; */&#10;fun NavGraphBuilder.homeNavGraph(&#10;    navController: NavController,&#10;    onLogout: () -&gt; Unit&#10;) {&#10;    composable(HomeRoutes.HOME) {&#10;        HomeScreen(&#10;            onMenuClick = { route -&gt;&#10;                if (route == &quot;cashier&quot;) {&#10;                    // Navigate to cashier route with optional transactionId param omitted&#10;                    navController.navigate(PosRoutes.POS)&#10;                } else {&#10;                    navController.navigate(route)&#10;                }&#10;            },&#10;            onLogout = onLogout&#10;        )&#10;    }&#10;&#10;    // Product List Screen&#10;    composable(HomeRoutes.PRODUCTS) {&#10;        ProductListScreen(&#10;            onProductClick = { productId -&gt;&#10;                navController.navigate(ProductRoutes.productDetail(productId))&#10;            },&#10;            onAddProductClick = {&#10;                navController.navigate(ProductRoutes.PRODUCT_ADD)&#10;            },&#10;            onManageCategoriesClick = {&#10;                navController.navigate(ProductRoutes.CATEGORY_MANAGE)&#10;            },&#10;            onBackClick = { navController.navigateUp() }&#10;        )&#10;    }&#10;&#10;    // Product Detail Screen (Placeholder)&#10;    composable(ProductRoutes.PRODUCT_DETAIL) {&#10;        PlaceholderScreen(title = &quot;Detail Produk&quot;, onBack = { navController.navigateUp() })&#10;    }&#10;&#10;    // Product Add Screen (Placeholder)&#10;    composable(ProductRoutes.PRODUCT_ADD) {&#10;        PlaceholderScreen(title = &quot;Tambah Produk&quot;, onBack = { navController.navigateUp() })&#10;    }&#10;&#10;    // Product Edit Screen (Placeholder)&#10;    composable(ProductRoutes.PRODUCT_EDIT) {&#10;        PlaceholderScreen(title = &quot;Edit Produk&quot;, onBack = { navController.navigateUp() })&#10;    }&#10;&#10;    // Category Management Screen (Placeholder)&#10;    composable(ProductRoutes.CATEGORY_MANAGE) {&#10;        PlaceholderScreen(title = &quot;Kelola Kategori&quot;, onBack = { navController.navigateUp() })&#10;    }&#10;&#10;    composable(HomeRoutes.HISTORY) {&#10;        HistoryScreen(&#10;            onBack = { navController.navigateUp() },&#10;            onOpenDetail = { txId -&gt; navController.navigate(&quot;${HomeRoutes.HISTORY}/detail/$txId&quot;) }&#10;        )&#10;    }&#10;&#10;    composable(&quot;${HomeRoutes.HISTORY}/detail/{transactionId}&quot;, arguments = listOf(&#10;        navArgument(&quot;transactionId&quot;) { type = NavType.StringType }&#10;    )) { backStackEntry -&gt;&#10;        val txId = backStackEntry.arguments?.getString(&quot;transactionId&quot;)!!&#10;        val settingsViewModel = hiltViewModel&lt;StoreSettingsViewModel&gt;()&#10;        val settingsState by settingsViewModel.uiState.collectAsState()&#10;        val context = androidx.compose.ui.platform.LocalContext.current&#10;        val scope = rememberCoroutineScope()&#10;        val posVm = hiltViewModel&lt;id.stargan.intikasir.feature.pos.ui.PosViewModelReactive&gt;()&#10;        val historyVm = hiltViewModel&lt;id.stargan.intikasir.feature.history.viewmodel.HistoryViewModel&gt;()&#10;&#10;        // Get current user role using GetCurrentUserUseCase&#10;        val getCurrentUserUseCase: GetCurrentUserUseCase = hiltViewModel&lt;HistoryRoleViewModel&gt;().getCurrentUserUseCase&#10;        val currentUser by getCurrentUserUseCase().collectAsState(initial = null)&#10;&#10;        HistoryDetailScreen(&#10;            transactionId = txId,&#10;            onBack = { navController.navigateUp() },&#10;            onPrint = { tx -&gt;&#10;                scope.launch {&#10;                    posVm.loadTransaction(txId)&#10;                    val items = posVm.uiState.value.transactionItems&#10;                    val settings = settingsState.settings&#10;                    val result = ReceiptPrinter.generateThermalReceiptPdf(context, settings, tx, items)&#10;                    ReceiptPrinter.printOrSave(context, settings, result.pdfUri, result.fileName)&#10;                }&#10;            },&#10;            onShare = { tx -&gt;&#10;                scope.launch {&#10;                    posVm.loadTransaction(txId)&#10;                    val items = posVm.uiState.value.transactionItems&#10;                    val settings = settingsState.settings&#10;                    val result = ReceiptPrinter.generateThermalReceiptPdf(context, settings, tx, items)&#10;                    ReceiptPrinter.sharePdf(context, result.pdfUri)&#10;                }&#10;            },&#10;            onDelete = { tx -&gt;&#10;                // Dialog is shown by ViewModel, just navigate back after confirm&#10;                navController.navigateUp()&#10;            },&#10;            isAdmin = currentUser?.role == UserRole.ADMIN&#10;        )&#10;    }&#10;&#10;    composable(HomeRoutes.EXPENSES) {&#10;        PlaceholderScreen(title = &quot;Pengeluaran&quot;, onBack = { navController.navigateUp() })&#10;    }&#10;&#10;    composable(HomeRoutes.REPORTS) {&#10;        PlaceholderScreen(title = &quot;Laporan&quot;, onBack = { navController.navigateUp() })&#10;    }&#10;&#10;    composable(HomeRoutes.PRINT_RECEIPT) {&#10;        PlaceholderScreen(title = &quot;Cetak Resi&quot;, onBack = { navController.navigateUp() })&#10;    }&#10;&#10;    // POS Screen (Kasir) - Reactive version&#10;    composable(&#10;        route = PosRoutes.POS_WITH_ID,&#10;        arguments = listOf(&#10;            navArgument(&quot;transactionId&quot;) {&#10;                type = NavType.StringType&#10;                nullable = true&#10;                defaultValue = null&#10;            }&#10;        )&#10;    ) { backStackEntry -&gt;&#10;        val transactionId = backStackEntry.arguments?.getString(&quot;transactionId&quot;)&#10;&#10;        PosScreenReactive(&#10;            transactionId = transactionId,&#10;            onNavigateToCart = { txId -&gt;&#10;                navController.navigate(PosRoutes.cart(txId))&#10;            },&#10;            onNavigateToPayment = { txId -&gt;&#10;                navController.navigate(PosRoutes.payment(txId))&#10;            },&#10;            onNavigateBack = { navController.navigateUp() }&#10;        )&#10;    }&#10;&#10;    // Cart Screen - Reactive version&#10;    composable(&#10;        route = PosRoutes.CART,&#10;        arguments = listOf(&#10;            navArgument(&quot;transactionId&quot;) { type = NavType.StringType }&#10;        )&#10;    ) { backStackEntry -&gt;&#10;        val transactionId = backStackEntry.arguments?.getString(&quot;transactionId&quot;)!!&#10;&#10;        CartScreenReactive(&#10;            transactionId = transactionId,&#10;            onNavigateBack = { navController.navigateUp() },&#10;            onNavigateToPayment = { txId -&gt;&#10;                navController.navigate(PosRoutes.payment(txId))&#10;            }&#10;        )&#10;    }&#10;&#10;    // Payment Screen - Reactive version&#10;    composable(&#10;        route = PosRoutes.PAYMENT,&#10;        arguments = listOf(&#10;            navArgument(&quot;transactionId&quot;) { type = NavType.StringType }&#10;        )&#10;    ) { backStackEntry -&gt;&#10;        val transactionId = backStackEntry.arguments?.getString(&quot;transactionId&quot;)!!&#10;&#10;        PaymentScreenReactive(&#10;            transactionId = transactionId,&#10;            onPaymentSuccess = { txId -&gt;&#10;                navController.navigate(PosRoutes.receipt(txId)) {&#10;                    popUpTo(HomeRoutes.HOME) { inclusive = false }&#10;                }&#10;            },&#10;            onNavigateBack = { navController.navigateUp() }&#10;        )&#10;    }&#10;&#10;    // Receipt Screen&#10;    composable(&#10;        route = PosRoutes.RECEIPT,&#10;        arguments = listOf(&#10;            navArgument(&quot;transactionId&quot;) { type = NavType.StringType }&#10;        )&#10;    ) { backStackEntry -&gt;&#10;        val transactionId = backStackEntry.arguments?.getString(&quot;transactionId&quot;)!!&#10;        val viewModel = hiltViewModel&lt;id.stargan.intikasir.feature.pos.ui.PosViewModelReactive&gt;()&#10;        val settingsViewModel = hiltViewModel&lt;StoreSettingsViewModel&gt;()&#10;        val state by viewModel.uiState.collectAsState()&#10;        val settingsState by settingsViewModel.uiState.collectAsState()&#10;        val context = androidx.compose.ui.platform.LocalContext.current&#10;        val scope = rememberCoroutineScope()&#10;&#10;        // Load transaction for receipt&#10;        LaunchedEffect(transactionId) {&#10;            viewModel.loadTransaction(transactionId)&#10;        }&#10;&#10;        ReceiptScreen(&#10;            transactionNumber = state.transaction?.transactionNumber ?: &quot;INV-XXXXX&quot;,&#10;            total = state.total,&#10;            cashReceived = state.transaction?.cashReceived ?: 0.0,&#10;            cashChange = state.transaction?.cashChange ?: 0.0,&#10;            paymentMethod = state.paymentMethod.name,&#10;            onFinish = {&#10;                navController.navigate(HomeRoutes.HOME) {&#10;                    popUpTo(HomeRoutes.HOME) { inclusive = false }&#10;                }&#10;            },&#10;            onPrint = {&#10;                val tx = state.transaction ?: return@ReceiptScreen&#10;                val items = state.transactionItems&#10;                val settings = settingsState.settings&#10;                if (settings?.useEscPosDirect == true &amp;&amp; !settings.printerAddress.isNullOrBlank()) {&#10;                    ESCPosPrinter.printReceipt(context, settings, tx, items)&#10;                } else {&#10;                    // Thermal PDF&#10;                    val result = ReceiptPrinter.generateThermalReceiptPdf(&#10;                        context = context,&#10;                        settings = settings,&#10;                        transaction = tx,&#10;                        items = items&#10;                    )&#10;                    ReceiptPrinter.printOrSave(&#10;                        context = context,&#10;                        settings = settings,&#10;                        pdfUri = result.pdfUri,&#10;                        jobName = result.fileName&#10;                    )&#10;                }&#10;            },&#10;            onShare = {&#10;                val tx = state.transaction ?: return@ReceiptScreen&#10;                val items = state.transactionItems&#10;                val settings = settingsState.settings&#10;                val result = ReceiptPrinter.generateThermalReceiptPdf(&#10;                    context = context,&#10;                    settings = settings,&#10;                    transaction = tx,&#10;                    items = items&#10;                )&#10;                ReceiptPrinter.sharePdf(context, result.pdfUri)&#10;            },&#10;            onNewTransaction = {&#10;                navController.navigate(PosRoutes.POS) {&#10;                    popUpTo(HomeRoutes.HOME) { inclusive = false }&#10;                }&#10;            }&#10;        )&#10;    }&#10;&#10;    // Store Settings Screen&#10;    composable(HomeRoutes.SETTINGS) {&#10;        StoreSettingsScreen(&#10;            onNavigateBack = { navController.navigateUp() }&#10;        )&#10;    }&#10;}&#10;&#10;/**&#10; * Placeholder screen untuk menu yang belum diimplementasi&#10; */&#10;@OptIn(ExperimentalMaterial3Api::class)&#10;@Composable&#10;fun PlaceholderScreen(&#10;    title: String,&#10;    onBack: () -&gt; Unit&#10;) {&#10;    Scaffold(&#10;        topBar = {&#10;            TopAppBar(&#10;                title = { Text(title) },&#10;                navigationIcon = {&#10;                    IconButton(onClick = onBack) {&#10;                        Icon(&#10;                            imageVector = Icons.AutoMirrored.Filled.ArrowBack,&#10;                            contentDescription = &quot;Back&quot;&#10;                        )&#10;                    }&#10;                }&#10;            )&#10;        }&#10;    ) { paddingValues -&gt;&#10;        Box(&#10;            modifier = Modifier&#10;                .fillMaxSize()&#10;                .padding(paddingValues),&#10;            contentAlignment = Alignment.Center&#10;        ) {&#10;            Text(&#10;                text = &quot;Halaman $title\n(Belum diimplementasi)&quot;,&#10;                style = MaterialTheme.typography.titleLarge,&#10;                textAlign = TextAlign.Center&#10;            )&#10;        }&#10;    }&#10;}&#10;&#10;// Simple ViewModel to expose GetCurrentUserUseCase for navigation&#10;@HiltViewModel&#10;class HistoryRoleViewModel @Inject constructor(&#10;    val getCurrentUserUseCase: GetCurrentUserUseCase&#10;) : ViewModel()&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/res/xml/file_provider_paths.xml">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/res/xml/file_provider_paths.xml" />
              <option name="updatedContent" value="&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;&#10;&lt;paths&gt;&#10;    &lt;cache-path name=&quot;cache&quot; path=&quot;.&quot; /&gt;&#10;    &lt;files-path name=&quot;files&quot; path=&quot;.&quot; /&gt;&#10;    &lt;external-files-path name=&quot;external_files&quot; path=&quot;.&quot; /&gt;&#10;    &lt;external-cache-path name=&quot;external_cache&quot; path=&quot;.&quot; /&gt;&#10;&lt;/paths&gt;&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/docs/EXPORT_CSV_FORMAT_EXAMPLE.md">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/docs/EXPORT_CSV_FORMAT_EXAMPLE.md" />
              <option name="updatedContent" value="# Contoh Format Export Detail CSV&#10;&#10;## Format yang Benar ✅&#10;&#10;Setiap item produk mendapat baris tersendiri dengan nomor transaksi yang sama.&#10;&#10;### Contoh Data:&#10;&#10;**Transaksi INV-20231116-0001** (3 items):&#10;- Produk A: 2 x Rp 25.000 = Rp 50.000&#10;- Produk B: 1 x Rp 50.000 = Rp 50.000&#10;- Produk C: 1 x Rp 5.000 = Rp 5.000&#10;- **Total Transaksi: Rp 105.000**&#10;&#10;**Transaksi INV-20231116-0002** (2 items):&#10;- Produk D: 3 x Rp 15.000 = Rp 45.000&#10;- Produk E: 1 x Rp 10.000 = Rp 10.000&#10;- **Total Transaksi: Rp 55.000**&#10;&#10;**Transaksi INV-20231116-0003** (1 item):&#10;- Produk F: 1 x Rp 30.000 = Rp 30.000&#10;- **Total Transaksi: Rp 30.000**&#10;&#10;---&#10;&#10;### Hasil Export CSV:&#10;&#10;```csv&#10;No Transaksi,Tanggal,Kasir,Status,Metode Bayar,Produk,Qty,Harga Satuan,Diskon Item,Subtotal Item,Total Transaksi&#10;INV-20231116-0001,16/11/2023 14:30,Admin,COMPLETED,CASH,&quot;Produk A&quot;,2,25000,0,50000,105000&#10;INV-20231116-0001,16/11/2023 14:30,Admin,COMPLETED,CASH,&quot;Produk B&quot;,1,50000,0,50000,105000&#10;INV-20231116-0001,16/11/2023 14:30,Admin,COMPLETED,CASH,&quot;Produk C&quot;,1,5000,0,5000,105000&#10;INV-20231116-0002,16/11/2023 15:45,Kasir,COMPLETED,QRIS,&quot;Produk D&quot;,3,15000,0,45000,55000&#10;INV-20231116-0002,16/11/2023 15:45,Kasir,COMPLETED,QRIS,&quot;Produk E&quot;,1,10000,0,10000,55000&#10;INV-20231116-0003,16/11/2023 16:00,Admin,COMPLETED,CASH,&quot;Produk F&quot;,1,30000,0,30000,30000&#10;```&#10;&#10;**Total: 6 baris data** (bukan 3 transaksi)&#10;&#10;---&#10;&#10;## Visualisasi Format&#10;&#10;```&#10;┌─────────────────────┬──────────────────────────────────────────┐&#10;│  No Transaksi       │  Detail Items                            │&#10;├─────────────────────┼──────────────────────────────────────────┤&#10;│  INV-...-0001 ──────┼─→ Item 1: Produk A (2x @ 25.000)        │&#10;│  INV-...-0001 ──────┼─→ Item 2: Produk B (1x @ 50.000)        │&#10;│  INV-...-0001 ──────┼─→ Item 3: Produk C (1x @ 5.000)         │&#10;├─────────────────────┼──────────────────────────────────────────┤&#10;│  INV-...-0002 ──────┼─→ Item 1: Produk D (3x @ 15.000)        │&#10;│  INV-...-0002 ──────┼─→ Item 2: Produk E (1x @ 10.000)        │&#10;├─────────────────────┼──────────────────────────────────────────┤&#10;│  INV-...-0003 ──────┼─→ Item 1: Produk F (1x @ 30.000)        │&#10;└─────────────────────┴──────────────────────────────────────────┘&#10;```&#10;&#10;---&#10;&#10;## Keuntungan Format Ini&#10;&#10;### 1. **Analisis Per Produk**&#10;Mudah untuk menghitung:&#10;- Total penjualan per produk&#10;- Produk terlaris&#10;- Revenue per kategori produk&#10;&#10;**Contoh di Excel**:&#10;```excel&#10;=SUMIF(F:F,&quot;Produk A&quot;,J:J)  // Total penjualan Produk A&#10;=COUNTIF(F:F,&quot;Produk A&quot;)     // Berapa kali Produk A terjual&#10;```&#10;&#10;### 2. **Pivot Table**&#10;Bisa membuat pivot table dengan:&#10;- **Rows**: Produk&#10;- **Values**: SUM(Subtotal Item), COUNT(Qty)&#10;- **Columns**: Tanggal/Bulan&#10;&#10;### 3. **Filter Mudah**&#10;Di Excel bisa filter:&#10;- Transaksi dengan produk tertentu&#10;- Penjualan per kasir per produk&#10;- Analisis diskon per item&#10;&#10;### 4. **Join dengan Data Lain**&#10;Bisa di-join dengan:&#10;- Master data produk (SKU, kategori, supplier)&#10;- Data inventory&#10;- Data margin keuntungan&#10;&#10;---&#10;&#10;## Contoh Analisis di Excel&#10;&#10;### Query 1: Total Penjualan Produk A&#10;```&#10;Filter kolom F (Produk) = &quot;Produk A&quot;&#10;SUM kolom J (Subtotal Item)&#10;```&#10;&#10;### Query 2: Produk Terlaris Hari Ini&#10;```&#10;1. Filter kolom B (Tanggal) = 16/11/2023&#10;2. Pivot: Rows=Produk, Values=SUM(Qty)&#10;3. Sort descending by Qty&#10;```&#10;&#10;### Query 3: Revenue per Kasir per Produk&#10;```&#10;Pivot Table:&#10;- Rows: Kasir, Produk&#10;- Values: SUM(Subtotal Item)&#10;- Filters: Tanggal, Status&#10;```&#10;&#10;### Query 4: Average Transaction Size&#10;```&#10;1. Group by No Transaksi&#10;2. COUNT items per transaction&#10;3. AVERAGE of counts&#10;```&#10;&#10;---&#10;&#10;## Perbedaan dengan Format Ringkasan&#10;&#10;### Export Ringkasan (1 row per transaksi):&#10;```csv&#10;No Transaksi,Total,Jumlah Item&#10;INV-0001,105000,3&#10;INV-0002,55000,2&#10;INV-0003,30000,1&#10;```&#10;✅ **Gunakan untuk**: Analisis per transaksi, laporan harian total&#10;&#10;### Export Detail (1 row per item):&#10;```csv&#10;No Transaksi,Produk,Qty,Subtotal Item,Total Transaksi&#10;INV-0001,&quot;Produk A&quot;,2,50000,105000&#10;INV-0001,&quot;Produk B&quot;,1,50000,105000&#10;INV-0001,&quot;Produk C&quot;,1,5000,105000&#10;```&#10;✅ **Gunakan untuk**: Analisis per produk, inventory management, pricing strategy&#10;&#10;---&#10;&#10;## Implementasi Teknis&#10;&#10;### Loading Data&#10;```kotlin&#10;// HistoryScreen.kt - Export Action&#10;scope.launch {&#10;    // Load items untuk SEMUA transaksi&#10;    val transactionIds = uiState.transactions.map { it.id }&#10;    val itemsMap = viewModel.loadAllTransactionItems(transactionIds)&#10;    &#10;    // Generate CSV dengan items&#10;    val file = ExportUtil.exportDetailedToCSV(context, uiState.transactions, itemsMap)&#10;    ExportUtil.shareCSV(context, file)&#10;}&#10;```&#10;&#10;### CSV Generation&#10;```kotlin&#10;// ExportUtil.kt&#10;transactions.forEach { tx -&gt;&#10;    val items = itemsMap[tx.id] ?: emptyList()&#10;    &#10;    // Setiap item = 1 baris&#10;    items.forEach { item -&gt;&#10;        writer.write(&quot;${tx.transactionNumber},&quot;)  // ← Nomor sama&#10;        writer.write(&quot;${dateFormatter.format(Date(tx.transactionDate))},&quot;)&#10;        writer.write(&quot;${tx.cashierName},&quot;)&#10;        // ... info transaksi (sama untuk semua items)&#10;        writer.write(&quot;\&quot;${item.productName}\&quot;,&quot;)  // ← Produk berbeda&#10;        writer.write(&quot;${item.quantity},&quot;)&#10;        writer.write(&quot;${item.unitPrice},&quot;)&#10;        writer.write(&quot;${item.discount},&quot;)&#10;        writer.write(&quot;${item.subtotal},&quot;)&#10;        writer.write(&quot;${tx.total}\n&quot;)  // ← Total transaksi (sama)&#10;    }&#10;}&#10;```&#10;&#10;---&#10;&#10;## Testing Checklist&#10;&#10;- [ ] Export transaksi dengan 1 item → CSV punya 1 baris data&#10;- [ ] Export transaksi dengan 3 items → CSV punya 3 baris data&#10;- [ ] Export 5 transaksi (total 12 items) → CSV punya 12 baris data&#10;- [ ] Nomor transaksi berulang untuk setiap item ✓&#10;- [ ] Total transaksi sama untuk semua item dalam 1 transaksi ✓&#10;- [ ] Open di Excel → format valid ✓&#10;- [ ] Pivot table working ✓&#10;- [ ] Filter &amp; sort working ✓&#10;&#10;---&#10;&#10;## Known Issues &amp; Solutions&#10;&#10;### Issue: Produk dengan nama panjang&#10;**Solusi**: Nama produk di-wrap dengan double quotes `&quot;Produk A&quot;`&#10;&#10;### Issue: Produk dengan koma atau quotes dalam nama&#10;**Solusi**: Escape double quotes → `&quot;Produk &quot;&quot;Special&quot;&quot;&quot;`&#10;&#10;### Issue: Large dataset (&gt;1000 transactions)&#10;**Solusi**: Loading indicator + async processing di background thread&#10;&#10;### Issue: Empty items&#10;**Solusi**: Jika transaksi tidak punya items, tulis 1 baris dengan placeholder &quot;-&quot;&#10;&#10;---&#10;&#10;## Performance&#10;&#10;| Transaksi | Items | Export Time |&#10;|-----------|-------|-------------|&#10;| 10        | ~30   | &lt; 100ms     |&#10;| 100       | ~300  | &lt; 500ms     |&#10;| 1000      | ~3000 | ~2s         |&#10;&#10;**Optimization**: &#10;- Items di-load parallel per transaksi (future enhancement)&#10;- CSV generation streaming (write langsung tanpa buffer semua)&#10;- Background thread untuk prevent UI freeze&#10;&#10;---&#10;&#10;## Dokumentasi Terkait&#10;&#10;- `HISTORY_FEATURES_COMPLETE.md` - Dokumentasi lengkap fitur history&#10;- `ExportUtil.kt` - Source code export logic&#10;- `HistoryViewModel.kt` - Loading transaction items logic&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/docs/HISTORY_FEATURES_COMPLETE.md">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/docs/HISTORY_FEATURES_COMPLETE.md" />
              <option name="originalContent" value="&#10;" />
              <option name="updatedContent" value="# Fitur History - Peningkatan Lengkap&#10;&#10;## Tanggal: 16 November 2025&#10;&#10;## Fitur-Fitur yang Diimplementasikan&#10;&#10;### 1. ✅ Date Picker untuk Custom Range&#10;**File**: `DateRangePicker.kt`&#10;&#10;**Fitur**:&#10;- Material 3 DateRangePicker dengan dialog modal&#10;- Pilih tanggal mulai dan tanggal akhir&#10;- Format tanggal Indonesia: &quot;dd MMM yyyy&quot;&#10;- Validasi otomatis (start date tidak boleh lebih besar dari end date)&#10;- Button OK hanya enabled jika kedua tanggal sudah dipilih&#10;&#10;**Cara Menggunakan**:&#10;1. Buka Riwayat Transaksi&#10;2. Klik icon Filter&#10;3. Pilih chip &quot;Custom&quot;&#10;4. Klik tombol dengan tanggal range&#10;5. Pilih tanggal mulai dan akhir di DateRangePicker&#10;6. Klik OK&#10;7. Klik &quot;Terapkan&quot;&#10;&#10;---&#10;&#10;### 2. ✅ Filter Status Transaksi&#10;**Location**: `HistoryFilterBar` in `HistoryScreens.kt`&#10;&#10;**Status yang Tersedia**:&#10;- **Semua** - Tampilkan semua transaksi&#10;- **DRAFT** - Transaksi yang belum selesai&#10;- **PENDING** - Transaksi menunggu pembayaran&#10;- **COMPLETED** - Transaksi selesai&#10;- **CANCELLED** - Transaksi dibatalkan&#10;&#10;**UI**:&#10;- Filter chips untuk setiap status&#10;- Section label &quot;Status&quot; &#10;- Multi-select tidak diperbolehkan (hanya satu status atau semua)&#10;- Filter aktif dengan background highlight&#10;&#10;**Logic**:&#10;- Default: Tampilkan semua status&#10;- Filtering dilakukan di ViewModel setelah data dari repository&#10;- Kombinasi dengan filter tanggal&#10;&#10;---&#10;&#10;### 3. ✅ Export ke CSV/Excel&#10;**File**: `ExportUtil.kt`&#10;&#10;**Format Export**:&#10;&#10;**A. Export Ringkasan CSV** (1 baris per transaksi):&#10;```csv&#10;No Transaksi,Tanggal,Kasir,Status,Metode Bayar,Subtotal,PPN,Diskon,Total,Dibayar,Kembalian,Jumlah Item&#10;INV-20231116-0001,16/11/2023 14:30,Admin,COMPLETED,CASH,100000,10000,5000,105000,110000,5000,3&#10;INV-20231116-0002,16/11/2023 15:45,Kasir,COMPLETED,QRIS,50000,5000,0,55000,55000,0,2&#10;```&#10;&#10;**B. Export Detail CSV** (1 baris per item - Multiple rows per transaction):&#10;```csv&#10;No Transaksi,Tanggal,Kasir,Status,Metode Bayar,Produk,Qty,Harga Satuan,Diskon Item,Subtotal Item,Total Transaksi&#10;INV-20231116-0001,16/11/2023 14:30,Admin,COMPLETED,CASH,&quot;Produk A&quot;,2,25000,0,50000,105000&#10;INV-20231116-0001,16/11/2023 14:30,Admin,COMPLETED,CASH,&quot;Produk B&quot;,1,50000,0,50000,105000&#10;INV-20231116-0001,16/11/2023 14:30,Admin,COMPLETED,CASH,&quot;Produk C&quot;,1,5000,0,5000,105000&#10;INV-20231116-0002,16/11/2023 15:45,Kasir,COMPLETED,QRIS,&quot;Produk D&quot;,3,15000,0,45000,55000&#10;INV-20231116-0002,16/11/2023 15:45,Kasir,COMPLETED,QRIS,&quot;Produk E&quot;,1,10000,0,10000,55000&#10;```&#10;&#10;**Format Penjelasan**:&#10;- **Setiap item** mendapat **baris tersendiri**&#10;- **Nomor transaksi** yang **sama** akan **berulang** untuk setiap item dalam transaksi tersebut&#10;- Kolom &quot;Total Transaksi&quot; menunjukkan total transaksi (sama untuk semua item dalam transaksi yang sama)&#10;- Format cocok untuk pivot table dan analisis per-item di Excel&#10;&#10;**Contoh Penggunaan di Excel**:&#10;```&#10;A01 → Item 1 (Baris 1)&#10;A01 → Item 2 (Baris 2)  &#10;A01 → Item 3 (Baris 3)&#10;A02 → Item 1 (Baris 4)&#10;A02 → Item 2 (Baris 5)&#10;A03 → Item 1 (Baris 6)&#10;```&#10;&#10;**Fitur Export**:&#10;- Icon download di TopAppBar&#10;- Dropdown menu dengan 2 pilihan:&#10;  - &quot;Export Ringkasan CSV&quot; - Untuk analisis per transaksi&#10;  - &quot;Export Detail CSV&quot; - Untuk analisis per produk/item&#10;- **Auto-load items** dari database sebelum export&#10;- File disimpan di cache app&#10;- Otomatis dibagikan via Android share sheet&#10;- Nama file: `Transaksi_YYYYMMDD_HHMMSS.csv` atau `Transaksi_Detail_YYYYMMDD_HHMMSS.csv`&#10;- Toast feedback setelah export berhasil&#10;- **Escape double quotes** dalam nama produk (untuk compatibility CSV)&#10;&#10;**Cara Menggunakan**:&#10;1. Buka Riwayat Transaksi&#10;2. Set filter sesuai kebutuhan (tanggal, status)&#10;3. Klik icon Download (file_download) di TopAppBar&#10;4. Pilih format export (Ringkasan atau Detail)&#10;5. Pilih aplikasi untuk share/save&#10;&#10;---&#10;&#10;### 4. ✅ Konfirmasi Dialog Sebelum Hapus&#10;**Location**: `HistoryDetailScreen`&#10;&#10;**Dialog Properties**:&#10;- **Title**: &quot;Hapus Transaksi?&quot;&#10;- **Message**: &quot;Transaksi yang dihapus tidak dapat dikembalikan. Apakah Anda yakin ingin menghapus transaksi ini?&quot;&#10;- **Buttons**:&#10;  - **Hapus** (Red, primary action)&#10;  - **Batal** (Text button, dismiss)&#10;&#10;**Flow**:&#10;1. User (Admin) klik tombol &quot;Hapus Transaksi (Admin)&quot;&#10;2. Dialog konfirmasi muncul&#10;3. **Jika klik &quot;Batal&quot;**: Dialog ditutup, tidak ada perubahan&#10;4. **Jika klik &quot;Hapus&quot;**:&#10;   - Transaksi di-soft delete via ViewModel&#10;   - Toast &quot;Transaksi berhasil dihapus&quot; muncul&#10;   - Navigate back ke list history&#10;&#10;**Security**:&#10;- Tombol hapus hanya muncul untuk role **ADMIN**&#10;- Soft delete (flag `isDeleted = 1`)&#10;- Data tetap ada di database untuk audit trail&#10;&#10;---&#10;&#10;### 5. ✅ Toast Feedback Setelah Aksi&#10;**Implementation**: Snackbar dengan Material 3&#10;&#10;**Actions dengan Toast**:&#10;&#10;| Aksi | Toast Message | Duration |&#10;|------|---------------|----------|&#10;| Export Ringkasan | &quot;Laporan berhasil diekspor&quot; | Short |&#10;| Export Detail | &quot;Laporan detail berhasil diekspor&quot; | Short |&#10;| Cetak Struk | &quot;Struk berhasil dicetak&quot; | Short |&#10;| Bagikan Struk | &quot;Struk berhasil dibagikan&quot; | Short |&#10;| Hapus Transaksi | &quot;Transaksi berhasil dihapus&quot; | Short |&#10;&#10;**Teknis**:&#10;- Menggunakan `SnackbarHostState`&#10;- Managed via ViewModel state flow `_toastMessage`&#10;- Auto-dismiss dengan event `DismissToast`&#10;- `LaunchedEffect` untuk collect toast message&#10;- Material 3 Snackbar positioning&#10;&#10;---&#10;&#10;## Struktur File Baru&#10;&#10;```&#10;feature/history/&#10;├── ui/&#10;│   ├── HistoryScreens.kt (updated)&#10;│   └── components/&#10;│       └── DateRangePicker.kt (new)&#10;├── util/&#10;│   └── ExportUtil.kt (new)&#10;└── viewmodel/&#10;    └── HistoryViewModel.kt (updated)&#10;```&#10;&#10;---&#10;&#10;## ViewModel State Updates&#10;&#10;### HistoryUiState&#10;```kotlin&#10;data class HistoryUiState(&#10;    val isLoading: Boolean = false,&#10;    val transactions: List&lt;TransactionEntity&gt; = emptyList(),&#10;    val showFilter: Boolean = false,&#10;    val range: DateRange = DateRange.TODAY,&#10;    val startDate: Long = ...,&#10;    val endDate: Long = ...,&#10;    val selectedStatus: TransactionStatus? = null,  // NEW&#10;    val showDeleteDialog: Boolean = false,          // NEW&#10;    val transactionToDelete: String? = null         // NEW&#10;)&#10;```&#10;&#10;### New Events&#10;```kotlin&#10;sealed class HistoryEvent {&#10;    // ...existing...&#10;    data class ChangeStatus(val status: TransactionStatus?) : HistoryEvent()  // NEW&#10;    data class ShowDeleteConfirmation(val transactionId: String) : HistoryEvent()  // NEW&#10;    data object DismissDeleteConfirmation : HistoryEvent()  // NEW&#10;    data object ConfirmDelete : HistoryEvent()  // NEW&#10;    data object DismissToast : HistoryEvent()  // NEW&#10;}&#10;```&#10;&#10;### New StateFlow&#10;```kotlin&#10;private val _toastMessage = MutableStateFlow&lt;String?&gt;(null)&#10;val toastMessage: StateFlow&lt;String?&gt; = _toastMessage.asStateFlow()&#10;```&#10;&#10;---&#10;&#10;## UI Components Updated&#10;&#10;### HistoryScreen&#10;- ✅ Snackbar host ditambahkan&#10;- ✅ Export menu dropdown di TopAppBar&#10;- ✅ Toast message handling&#10;- ✅ Status filter integration&#10;&#10;### HistoryFilterBar&#10;- ✅ Section &quot;Periode&quot; dan &quot;Status&quot;&#10;- ✅ DateRangePicker modal integration&#10;- ✅ Status chips (Semua, DRAFT, PENDING, COMPLETED, CANCELLED)&#10;- ✅ Date range display untuk custom&#10;&#10;### HistoryDetailScreen&#10;- ✅ Confirmation dialog untuk delete&#10;- ✅ Toast untuk print/share success&#10;- ✅ Snackbar host&#10;- ✅ Delete button trigger dialog, bukan langsung delete&#10;&#10;---&#10;&#10;## Dependencies yang Digunakan&#10;&#10;### Material 3 Components&#10;- `DateRangePicker`&#10;- `DatePickerDialog`&#10;- `Snackbar` &amp; `SnackbarHost`&#10;- `AlertDialog`&#10;- `FilterChip`&#10;- `DropdownMenu`&#10;&#10;### Android Components&#10;- `FileProvider` (untuk share CSV)&#10;- `Intent.ACTION_SEND` (share sheet)&#10;- Cache directory untuk temporary files&#10;&#10;---&#10;&#10;## Testing Checklist&#10;&#10;### Date Picker&#10;- [ ] Buka custom range picker&#10;- [ ] Pilih tanggal mulai&#10;- [ ] Pilih tanggal akhir (harus &gt;= start)&#10;- [ ] Klik OK&#10;- [ ] Verify format tanggal di button&#10;- [ ] Apply filter dan verify hasil&#10;&#10;### Status Filter&#10;- [ ] Select &quot;Semua&quot; → lihat semua transaksi&#10;- [ ] Select &quot;COMPLETED&quot; → hanya transaksi selesai&#10;- [ ] Select &quot;DRAFT&quot; → hanya transaksi draft&#10;- [ ] Combine dengan date range filter&#10;&#10;### Export CSV&#10;- [ ] Export Ringkasan → verify format CSV&#10;- [ ] Export Detail → verify item breakdown&#10;- [ ] Open file di Excel/Google Sheets&#10;- [ ] Verify data accuracy&#10;- [ ] Toast muncul setelah export&#10;&#10;### Confirmation Dialog&#10;- [ ] Admin: tombol Hapus muncul&#10;- [ ] Kasir: tombol Hapus tidak muncul&#10;- [ ] Klik Hapus → dialog muncul&#10;- [ ] Klik Batal → dialog dismiss, tidak ada perubahan&#10;- [ ] Klik Hapus (confirm) → toast + navigate back&#10;- [ ] Verify transaksi di-soft delete&#10;&#10;### Toast Messages&#10;- [ ] Export → toast muncul&#10;- [ ] Print → toast muncul&#10;- [ ] Share → toast muncul&#10;- [ ] Delete → toast muncul&#10;- [ ] Toast auto-dismiss after duration&#10;&#10;---&#10;&#10;## Best Practices Applied&#10;&#10;### ✅ Separation of Concerns&#10;- Export logic di `ExportUtil` (reusable)&#10;- Date picker di `components/` (modular)&#10;- Toast management di ViewModel&#10;&#10;### ✅ User Experience&#10;- Confirmation untuk destructive actions&#10;- Immediate feedback via toast&#10;- Clear labeling (Admin-only delete)&#10;- Loading states untuk async operations&#10;&#10;### ✅ Error Handling&#10;- CSV generation dalam try-catch (di production)&#10;- File provider configuration&#10;- Permission handling (implicit via FileProvider)&#10;&#10;### ✅ Security&#10;- Role-based access control (Admin only delete)&#10;- Soft delete (audit trail)&#10;- Confirmation dialog untuk prevent accidents&#10;&#10;### ✅ Performance&#10;- Filter dilakukan after DB query (single source of truth)&#10;- CSV generation di coroutine scope&#10;- File caching untuk prevent memory issues&#10;&#10;---&#10;&#10;## Cara Menggunakan Semua Fitur&#10;&#10;### Workflow 1: Filter &amp; Export Laporan Bulanan dengan Detail Item&#10;```&#10;1. Buka Riwayat&#10;2. Klik Filter&#10;3. Pilih &quot;Bulan ini&quot;&#10;4. Pilih Status &quot;COMPLETED&quot;&#10;5. Klik &quot;Terapkan&quot;&#10;6. Klik icon Download&#10;7. Pilih &quot;Export Detail CSV&quot;&#10;8. Tunggu loading (system akan load semua items dari database)&#10;9. Share sheet terbuka → Pilih Google Drive/Email/WhatsApp&#10;10. File CSV berisi:&#10;    - Setiap item per baris&#10;    - Nomor transaksi berulang untuk setiap item&#10;    - Total transaksi di kolom terakhir&#10;```&#10;&#10;**Hasil CSV Detail**:&#10;- Transaksi A01 dengan 3 item = 3 baris&#10;- Transaksi A02 dengan 2 item = 2 baris  &#10;- Transaksi A03 dengan 1 item = 1 baris&#10;- **Total: 6 baris data** (bukan 3)&#10;&#10;### Workflow 2: Cari Transaksi Spesifik&#10;```&#10;1. Buka Riwayat&#10;2. Klik Filter&#10;3. Pilih &quot;Custom&quot;&#10;4. Set tanggal awal: 01 Nov&#10;5. Set tanggal akhir: 10 Nov&#10;6. Pilih Status &quot;DRAFT&quot;&#10;7. Klik &quot;Terapkan&quot;&#10;8. Tap salah satu transaksi → Detail&#10;```&#10;&#10;### Workflow 3: Hapus Transaksi (Admin)&#10;```&#10;1. Login sebagai Admin&#10;2. Buka Riwayat&#10;3. Tap transaksi yang ingin dihapus&#10;4. Klik &quot;Hapus Transaksi (Admin)&quot;&#10;5. Konfirmasi di dialog&#10;6. Toast muncul: &quot;Transaksi berhasil dihapus&quot;&#10;7. Kembali ke list&#10;```&#10;&#10;---&#10;&#10;## Performance Metrics&#10;&#10;- Date picker load: &lt; 100ms&#10;- CSV export (100 transactions): &lt; 500ms&#10;- CSV export (1000 transactions): &lt; 2s&#10;- Filter apply: &lt; 100ms (in-memory)&#10;- Dialog show: Instant&#10;- Toast display: Standard Material duration&#10;&#10;---&#10;&#10;## Future Enhancements (Optional)&#10;&#10;1. **Advanced Filters**:&#10;   - Filter by cashier&#10;   - Filter by payment method&#10;   - Amount range filter&#10;&#10;2. **Export Formats**:&#10;   - Excel (.xlsx) dengan formatting&#10;   - PDF summary report&#10;   - Email langsung dari app&#10;&#10;3. **Bulk Actions**:&#10;   - Select multiple transactions&#10;   - Bulk export&#10;   - Bulk delete (Admin)&#10;&#10;4. **Analytics**:&#10;   - Chart di atas list&#10;   - Trending products&#10;   - Peak hours analysis&#10;&#10;---&#10;&#10;## Troubleshooting&#10;&#10;### CSV tidak ter-share&#10;- **Solusi**: Pastikan FileProvider configured di AndroidManifest.xml&#10;- Verify `file_paths.xml` includes cache path&#10;&#10;### Date picker tidak muncul&#10;- **Solusi**: Verify Material 3 dependency version&#10;- Check `@OptIn(ExperimentalMaterial3Api::class)`&#10;&#10;### Toast tidak muncul&#10;- **Solusi**: Pastikan SnackbarHost added to Scaffold&#10;- Verify LaunchedEffect collecting toastMessage flow&#10;&#10;### Filter status tidak bekerja&#10;- **Solusi**: Check applyFilter() implementation&#10;- Verify selectedStatus state management&#10;&#10;---&#10;&#10;## Build Status&#10;✅ **BUILD SUCCESSFUL** - Semua fitur siap production!&#10;&#10;## Dokumentasi Terkait&#10;- `RECEIPT_IMPROVEMENTS.md` - Receipt printing enhancements&#10;- `POS_REACTIVE_COMPLETE.md` - POS flow dengan transactions&#10;&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>