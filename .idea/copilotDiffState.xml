<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/app/src/main/java/id/stargan/intikasir/feature/home/ui/HomeScreen.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/id/stargan/intikasir/feature/home/ui/HomeScreen.kt" />
              <option name="originalContent" value="package id.stargan.intikasir.feature.home.ui&#10;&#10;import androidx.compose.foundation.layout.*&#10;import androidx.compose.foundation.lazy.grid.GridCells&#10;import androidx.compose.foundation.lazy.grid.LazyVerticalGrid&#10;import androidx.compose.foundation.lazy.grid.items&#10;import androidx.compose.material.icons.Icons&#10;import androidx.compose.material.icons.automirrored.filled.ExitToApp&#10;import androidx.compose.material3.*&#10;import androidx.compose.runtime.*&#10;import androidx.compose.ui.Modifier&#10;import androidx.compose.ui.layout.ContentScale&#10;import androidx.compose.foundation.background&#10;import androidx.compose.foundation.border&#10;import androidx.compose.foundation.shape.CircleShape&#10;import androidx.compose.ui.draw.clip&#10;import androidx.compose.ui.text.style.TextOverflow&#10;import androidx.compose.ui.tooling.preview.Preview&#10;import androidx.compose.ui.unit.dp&#10;import androidx.hilt.lifecycle.viewmodel.compose.hiltViewModel&#10;import android.net.Uri&#10;import coil.compose.AsyncImage&#10;import id.stargan.intikasir.feature.home.domain.model.MenuItems&#10;import id.stargan.intikasir.feature.reports.domain.model.PeriodType&#10;import id.stargan.intikasir.feature.reports.ui.ReportsEvent&#10;import id.stargan.intikasir.feature.reports.ui.ReportsViewModel&#10;import id.stargan.intikasir.feature.pos.navigation.PosRoutes&#10;import id.stargan.intikasir.feature.settings.ui.StoreSettingsViewModel&#10;import id.stargan.intikasir.feature.home.ui.components.MenuCard&#10;import id.stargan.intikasir.feature.home.ui.components.SalesSummaryCard&#10;import id.stargan.intikasir.feature.security.ui.SecuritySettingsViewModel&#10;import id.stargan.intikasir.feature.security.util.usePermission&#10;import kotlin.math.roundToLong&#10;&#10;/**&#10; * Stateless HomeScreen content — accepts plain data and callbacks so it can be previewed and tested&#10; */&#10;@OptIn(ExperimentalMaterial3Api::class)&#10;@Composable&#10;fun HomeScreenContent(&#10;    currentUserName: String?,&#10;    storeName: String?,&#10;    storeLogoUri: Uri?,&#10;    totalSales: Long?,&#10;    transactionCount: Int?,&#10;    netChange: Long?,&#10;    isLoading: Boolean,&#10;    menuList: List&lt;id.stargan.intikasir.feature.home.domain.model.MenuItem&gt;,&#10;    onMenuClick: (String) -&gt; Unit,&#10;    onLogoutClick: () -&gt; Unit,&#10;    onRetry: () -&gt; Unit,&#10;    onBannerClick: () -&gt; Unit = {},&#10;    modifier: Modifier = Modifier&#10;) {&#10;    Scaffold(&#10;        topBar = {&#10;            // Keep app identity visible in the top bar. The store identity will be in a banner below.&#10;            TopAppBar(&#10;                title = { Text(text = &quot;IntiKasir&quot;, style = MaterialTheme.typography.headlineSmall) },&#10;                actions = {&#10;                    IconButton(onClick = onLogoutClick) {&#10;                        Icon(&#10;                            imageVector = Icons.AutoMirrored.Filled.ExitToApp,&#10;                            contentDescription = &quot;Logout&quot;,&#10;                            tint = MaterialTheme.colorScheme.onPrimary&#10;                        )&#10;                    }&#10;                },&#10;                colors = TopAppBarDefaults.topAppBarColors(&#10;                    containerColor = MaterialTheme.colorScheme.primary,&#10;                    titleContentColor = MaterialTheme.colorScheme.onPrimary&#10;                )&#10;            )&#10;        },&#10;        modifier = modifier&#10;    ) { paddingValues -&gt;&#10;        Column(&#10;            modifier = Modifier&#10;                .fillMaxSize()&#10;                .padding(paddingValues)&#10;        ) {&#10;            // Banner + Sales summary on a dark primary background (compact and efficient)&#10;            val bannerHeight = 120.dp&#10;            Surface(&#10;                modifier = Modifier&#10;                    .fillMaxWidth(),&#10;                color = MaterialTheme.colorScheme.primary,&#10;                tonalElevation = 2.dp&#10;            ) {&#10;                Box(modifier = Modifier&#10;                    .fillMaxWidth()&#10;                    .height(bannerHeight)&#10;                ) {&#10;                    // Banner content (tight paddings)&#10;                    Row(&#10;                        modifier = Modifier&#10;                            .fillMaxWidth()&#10;                            .padding(horizontal = 16.dp, vertical = 8.dp)&#10;                            .align(androidx.compose.ui.Alignment.TopStart)&#10;                            .clickable { onBannerClick() },&#10;                        verticalAlignment = androidx.compose.ui.Alignment.CenterVertically&#10;                    ) {&#10;                        val logoSize = 40.dp&#10;                        if (storeLogoUri != null) {&#10;                            AsyncImage(&#10;                                model = storeLogoUri,&#10;                                contentDescription = storeName ?: &quot;Logo Toko&quot;,&#10;                                modifier = Modifier&#10;                                    .size(logoSize)&#10;                                    .clip(CircleShape)&#10;                                    .border(1.dp, MaterialTheme.colorScheme.onPrimary.copy(alpha = 0.08f), CircleShape),&#10;                                contentScale = ContentScale.Crop&#10;                            )&#10;                        } else {&#10;                            val initial = storeName?.firstOrNull()?.uppercaseChar()?.toString() ?: &quot;T&quot;&#10;                            Box(&#10;                                modifier = Modifier&#10;                                    .size(logoSize)&#10;                                    .clip(CircleShape)&#10;                                    .background(MaterialTheme.colorScheme.onPrimary.copy(alpha = 0.08f)),&#10;                                contentAlignment = androidx.compose.ui.Alignment.Center&#10;                            ) {&#10;                                Text(initial, style = MaterialTheme.typography.titleLarge, color = MaterialTheme.colorScheme.onPrimary)&#10;                            }&#10;                        }&#10;&#10;                        Spacer(Modifier.width(12.dp))&#10;&#10;                        Column(modifier = Modifier.weight(1f)) {&#10;                            Text(&#10;                                text = storeName ?: &quot;Nama Toko&quot;,&#10;                                style = MaterialTheme.typography.titleMedium,&#10;                                maxLines = 1,&#10;                                overflow = TextOverflow.Ellipsis,&#10;                                color = MaterialTheme.colorScheme.onPrimary&#10;                            )&#10;                            Text(&#10;                                text = currentUserName?.let { &quot;Halo, $it&quot; } ?: &quot;Selamat datang&quot;,&#10;                                style = MaterialTheme.typography.bodySmall,&#10;                                color = MaterialTheme.colorScheme.onPrimary.copy(alpha = 0.92f)&#10;                            )&#10;                        }&#10;                    }&#10;&#10;                    // Floating summary card that slightly overlaps the bottom edge of the banner for a modern, dense layout&#10;                    Box(&#10;                        modifier = Modifier&#10;                            .fillMaxWidth()&#10;                            .padding(horizontal = 16.dp)&#10;                            .align(androidx.compose.ui.Alignment.BottomCenter)&#10;                            .offset(y = 20.dp) // smaller overlap for tighter layout&#10;                    ) {&#10;                        SalesSummaryCard(&#10;                            totalSales = totalSales,&#10;                            transactionCount = transactionCount,&#10;                            netChange = netChange,&#10;                            isLoading = isLoading,&#10;                            onRetry = onRetry,&#10;                            cardColors = CardDefaults.cardColors(containerColor = MaterialTheme.colorScheme.primaryContainer),&#10;                            headlineColor = MaterialTheme.colorScheme.onPrimaryContainer,&#10;                            bodyColor = MaterialTheme.colorScheme.onPrimaryContainer.copy(alpha = 0.9f)&#10;                        )&#10;                    }&#10;                }&#10;            }&#10;&#10;            // Add spacer to account for the overlapped floating card so the grid won't be hidden under it&#10;            Spacer(modifier = Modifier.height(28.dp))&#10;&#10;            // Menu Grid&#10;            LazyVerticalGrid(&#10;                columns = GridCells.Fixed(3),&#10;                contentPadding = PaddingValues(16.dp),&#10;                horizontalArrangement = Arrangement.spacedBy(12.dp),&#10;                verticalArrangement = Arrangement.spacedBy(12.dp),&#10;                modifier = Modifier.fillMaxSize()&#10;            ) {&#10;                items(menuList) { menuItem -&gt;&#10;                    MenuCard(&#10;                        menuItem = menuItem,&#10;                        onClick = {&#10;                            if (menuItem.route == &quot;cashier&quot;) {&#10;                                onMenuClick(PosRoutes.POS)&#10;                            } else {&#10;                                onMenuClick(menuItem.route)&#10;                            }&#10;                        }&#10;                    )&#10;                }&#10;            }&#10;        }&#10;    }&#10;}&#10;&#10;/**&#10; * Stateful wrapper that keeps ViewModel usage and side-effects.&#10; * Collects state and delegates rendering to HomeScreenContent.&#10; */&#10;@OptIn(ExperimentalMaterial3Api::class)&#10;@Composable&#10;fun HomeScreen(&#10;    onMenuClick: (String) -&gt; Unit,&#10;    onLogout: () -&gt; Unit,&#10;    modifier: Modifier = Modifier,&#10;    viewModel: HomeViewModel = hiltViewModel()&#10;) {&#10;    val showLogoutDialog = remember { mutableStateOf(false) }&#10;    val currentUser by viewModel.currentUser.collectAsState()&#10;    val isLoggingOut by viewModel.isLoggingOut.collectAsState()&#10;&#10;    // Reports ViewModel to read dashboard summary (if available)&#10;    val reportsViewModel: ReportsViewModel = hiltViewModel()&#10;    val reportsUiState by reportsViewModel.uiState.collectAsState()&#10;    val dashboard = reportsUiState.dashboard&#10;&#10;    // Ensure we request &quot;TODAY&quot; dashboard when HomeScreen is shown so card reflects today's sales&#10;    LaunchedEffect(currentUser) {&#10;        val cashierIdToSet = if (currentUser?.role?.name == &quot;ADMIN&quot;) null else currentUser?.id&#10;        reportsViewModel.onEvent(ReportsEvent.SetCashierFilter(cashierIdToSet))&#10;        reportsViewModel.onEvent(ReportsEvent.SelectPeriod(PeriodType.TODAY))&#10;    }&#10;&#10;    // Permission: include Settings menu for cashier only if cashier has canEditSettings permission&#10;    val securityVm: SecuritySettingsViewModel = hiltViewModel()&#10;    val includeSettingsForCashier = usePermission(securityVm.observePermission(&quot;CASHIER&quot;) { it.canEditSettings })&#10;    val menuList = MenuItems.items(isAdmin = currentUser?.role?.name == &quot;ADMIN&quot;, includeSettingsForCashier = includeSettingsForCashier)&#10;&#10;    // Read store settings (name + logo preview) so header shows real data and graceful placeholder&#10;    val storeSettingsVm: StoreSettingsViewModel = hiltViewModel()&#10;    val storeUiState by storeSettingsVm.uiState.collectAsState()&#10;    val storeName = storeUiState.settings?.storeName&#10;    val storeLogoUri = storeUiState.logoPreviewUri&#10;&#10;    HomeScreenContent(&#10;        currentUserName = currentUser?.name,&#10;        storeName = storeName,&#10;        storeLogoUri = storeLogoUri,&#10;        totalSales = dashboard?.totalRevenue?.roundToLong(),&#10;        transactionCount = dashboard?.transactionCount,&#10;        netChange = reportsUiState.dashboardRevenueChange?.roundToLong(),&#10;        isLoading = reportsUiState.isLoading,&#10;        menuList = menuList,&#10;        onMenuClick = onMenuClick,&#10;        onLogoutClick = { showLogoutDialog.value = true },&#10;        onRetry = { reportsViewModel.onEvent(ReportsEvent.Refresh) },&#10;        modifier = modifier&#10;    )&#10;&#10;    // Logout dialog handled here (stateful behavior)&#10;    if (showLogoutDialog.value) {&#10;        AlertDialog(&#10;            onDismissRequest = {&#10;                if (!isLoggingOut) showLogoutDialog.value = false&#10;            },&#10;            title = { Text(&quot;Logout&quot;) },&#10;            text = {&#10;                if (isLoggingOut) {&#10;                    Row(horizontalArrangement = Arrangement.spacedBy(8.dp), verticalAlignment = androidx.compose.ui.Alignment.CenterVertically) {&#10;                        CircularProgressIndicator(modifier = Modifier.size(24.dp))&#10;                        Text(&quot;Sedang logout...&quot;)&#10;                    }&#10;                } else {&#10;                    Text(&quot;Apakah Anda yakin ingin keluar?&quot;)&#10;                }&#10;            },&#10;            confirmButton = {&#10;                TextButton(&#10;                    onClick = {&#10;                        viewModel.logout {&#10;                            showLogoutDialog.value = false&#10;                            onLogout()&#10;                        }&#10;                    },&#10;                    enabled = !isLoggingOut&#10;                ) { Text(&quot;Ya&quot;) }&#10;            },&#10;            dismissButton = {&#10;                TextButton(onClick = { showLogoutDialog.value = false }, enabled = !isLoggingOut) { Text(&quot;Batal&quot;) }&#10;            }&#10;        )&#10;    }&#10;}&#10;&#10;@Preview(showBackground = true)&#10;@Composable&#10;fun HomeScreenPreview() {&#10;    val sampleMenu = MenuItems.items(isAdmin = true)&#10;    MaterialTheme {&#10;        HomeScreenContent(&#10;            currentUserName = &quot;Demo User&quot;,&#10;            storeName = &quot;Toko Demo&quot;,&#10;            storeLogoUri = null,&#10;            totalSales = 123450L,&#10;            transactionCount = 12,&#10;            netChange = 5000L,&#10;            isLoading = false,&#10;            menuList = sampleMenu,&#10;            onMenuClick = {},&#10;            onLogoutClick = {},&#10;            onRetry = {}&#10;        )&#10;    }&#10;}&#10;" />
              <option name="updatedContent" value="package id.stargan.intikasir.feature.home.ui&#10;&#10;import androidx.compose.foundation.layout.*&#10;import androidx.compose.foundation.lazy.grid.GridCells&#10;import androidx.compose.foundation.lazy.grid.LazyVerticalGrid&#10;import androidx.compose.foundation.lazy.grid.items&#10;import androidx.compose.material.icons.Icons&#10;import androidx.compose.material.icons.automirrored.filled.ExitToApp&#10;import androidx.compose.material3.*&#10;import androidx.compose.runtime.*&#10;import androidx.compose.ui.Modifier&#10;import androidx.compose.ui.layout.ContentScale&#10;import androidx.compose.foundation.background&#10;import androidx.compose.foundation.clickable&#10;import androidx.compose.foundation.border&#10;import androidx.compose.foundation.shape.CircleShape&#10;import androidx.compose.ui.draw.clip&#10;import androidx.compose.ui.text.style.TextOverflow&#10;import androidx.compose.ui.tooling.preview.Preview&#10;import androidx.compose.ui.unit.dp&#10;import androidx.hilt.lifecycle.viewmodel.compose.hiltViewModel&#10;import android.net.Uri&#10;import coil.compose.AsyncImage&#10;import id.stargan.intikasir.feature.home.domain.model.MenuItems&#10;import id.stargan.intikasir.feature.reports.domain.model.PeriodType&#10;import id.stargan.intikasir.feature.reports.ui.ReportsEvent&#10;import id.stargan.intikasir.feature.reports.ui.ReportsViewModel&#10;import id.stargan.intikasir.feature.pos.navigation.PosRoutes&#10;import id.stargan.intikasir.feature.settings.ui.StoreSettingsViewModel&#10;import id.stargan.intikasir.feature.home.ui.components.MenuCard&#10;import id.stargan.intikasir.feature.home.ui.components.SalesSummaryCard&#10;import id.stargan.intikasir.feature.security.ui.SecuritySettingsViewModel&#10;import id.stargan.intikasir.feature.security.util.usePermission&#10;import kotlin.math.roundToLong&#10;&#10;/**&#10; * Stateless HomeScreen content — accepts plain data and callbacks so it can be previewed and tested&#10; */&#10;@OptIn(ExperimentalMaterial3Api::class)&#10;@Composable&#10;fun HomeScreenContent(&#10;    currentUserName: String?,&#10;    storeName: String?,&#10;    storeLogoUri: Uri?,&#10;    totalSales: Long?,&#10;    transactionCount: Int?,&#10;    netChange: Long?,&#10;    isLoading: Boolean,&#10;    menuList: List&lt;id.stargan.intikasir.feature.home.domain.model.MenuItem&gt;,&#10;    onMenuClick: (String) -&gt; Unit,&#10;    onLogoutClick: () -&gt; Unit,&#10;    onRetry: () -&gt; Unit,&#10;    onBannerClick: () -&gt; Unit = {},&#10;    modifier: Modifier = Modifier&#10;) {&#10;    Scaffold(&#10;        topBar = {&#10;            // Keep app identity visible in the top bar. The store identity will be in a banner below.&#10;            TopAppBar(&#10;                title = { Text(text = &quot;IntiKasir&quot;, style = MaterialTheme.typography.headlineSmall) },&#10;                actions = {&#10;                    IconButton(onClick = onLogoutClick) {&#10;                        Icon(&#10;                            imageVector = Icons.AutoMirrored.Filled.ExitToApp,&#10;                            contentDescription = &quot;Logout&quot;,&#10;                            tint = MaterialTheme.colorScheme.onPrimary&#10;                        )&#10;                    }&#10;                },&#10;                colors = TopAppBarDefaults.topAppBarColors(&#10;                    containerColor = MaterialTheme.colorScheme.primary,&#10;                    titleContentColor = MaterialTheme.colorScheme.onPrimary&#10;                )&#10;            )&#10;        },&#10;        modifier = modifier&#10;    ) { paddingValues -&gt;&#10;        Column(&#10;            modifier = Modifier&#10;                .fillMaxSize()&#10;                .padding(paddingValues)&#10;        ) {&#10;            // Banner + Sales summary on a dark primary background (compact and efficient)&#10;            val bannerHeight = 120.dp&#10;            Surface(&#10;                modifier = Modifier&#10;                    .fillMaxWidth(),&#10;                color = MaterialTheme.colorScheme.primary,&#10;                tonalElevation = 2.dp&#10;            ) {&#10;                Box(modifier = Modifier&#10;                    .fillMaxWidth()&#10;                    .height(bannerHeight)&#10;                ) {&#10;                    // Banner content (tight paddings)&#10;                    Row(&#10;                        modifier = Modifier&#10;                            .fillMaxWidth()&#10;                            .padding(horizontal = 16.dp, vertical = 8.dp)&#10;                            .align(androidx.compose.ui.Alignment.TopStart)&#10;                            .clickable { onBannerClick() },&#10;                        verticalAlignment = androidx.compose.ui.Alignment.CenterVertically&#10;                    ) {&#10;                        val logoSize = 40.dp&#10;                        if (storeLogoUri != null) {&#10;                            AsyncImage(&#10;                                model = storeLogoUri,&#10;                                contentDescription = storeName ?: &quot;Logo Toko&quot;,&#10;                                modifier = Modifier&#10;                                    .size(logoSize)&#10;                                    .clip(CircleShape)&#10;                                    .border(1.dp, MaterialTheme.colorScheme.onPrimary.copy(alpha = 0.08f), CircleShape),&#10;                                contentScale = ContentScale.Crop&#10;                            )&#10;                        } else {&#10;                            val initial = storeName?.firstOrNull()?.uppercaseChar()?.toString() ?: &quot;T&quot;&#10;                            Box(&#10;                                modifier = Modifier&#10;                                    .size(logoSize)&#10;                                    .clip(CircleShape)&#10;                                    .background(MaterialTheme.colorScheme.onPrimary.copy(alpha = 0.08f)),&#10;                                contentAlignment = androidx.compose.ui.Alignment.Center&#10;                            ) {&#10;                                Text(initial, style = MaterialTheme.typography.titleLarge, color = MaterialTheme.colorScheme.onPrimary)&#10;                            }&#10;                        }&#10;&#10;                        Spacer(Modifier.width(12.dp))&#10;&#10;                        Column(modifier = Modifier.weight(1f)) {&#10;                            Text(&#10;                                text = storeName ?: &quot;Nama Toko&quot;,&#10;                                style = MaterialTheme.typography.titleMedium,&#10;                                maxLines = 1,&#10;                                overflow = TextOverflow.Ellipsis,&#10;                                color = MaterialTheme.colorScheme.onPrimary&#10;                            )&#10;                            Text(&#10;                                text = currentUserName?.let { &quot;Halo, $it&quot; } ?: &quot;Selamat datang&quot;,&#10;                                style = MaterialTheme.typography.bodySmall,&#10;                                color = MaterialTheme.colorScheme.onPrimary.copy(alpha = 0.92f)&#10;                            )&#10;                        }&#10;                    }&#10;&#10;                    // Floating summary card that slightly overlaps the bottom edge of the banner for a modern, dense layout&#10;                    Box(&#10;                        modifier = Modifier&#10;                            .fillMaxWidth()&#10;                            .padding(horizontal = 16.dp)&#10;                            .align(androidx.compose.ui.Alignment.BottomCenter)&#10;                            .offset(y = 20.dp) // smaller overlap for tighter layout&#10;                    ) {&#10;                        SalesSummaryCard(&#10;                            totalSales = totalSales,&#10;                            transactionCount = transactionCount,&#10;                            netChange = netChange,&#10;                            isLoading = isLoading,&#10;                            onRetry = onRetry,&#10;                            cardColors = CardDefaults.cardColors(containerColor = MaterialTheme.colorScheme.primaryContainer),&#10;                            headlineColor = MaterialTheme.colorScheme.onPrimaryContainer,&#10;                            bodyColor = MaterialTheme.colorScheme.onPrimaryContainer.copy(alpha = 0.9f)&#10;                        )&#10;                    }&#10;                }&#10;            }&#10;&#10;            // Add spacer to account for the overlapped floating card so the grid won't be hidden under it&#10;            Spacer(modifier = Modifier.height(28.dp))&#10;&#10;            // Menu Grid&#10;            LazyVerticalGrid(&#10;                columns = GridCells.Fixed(3),&#10;                contentPadding = PaddingValues(16.dp),&#10;                horizontalArrangement = Arrangement.spacedBy(12.dp),&#10;                verticalArrangement = Arrangement.spacedBy(12.dp),&#10;                modifier = Modifier.fillMaxSize()&#10;            ) {&#10;                items(menuList) { menuItem -&gt;&#10;                    MenuCard(&#10;                        menuItem = menuItem,&#10;                        onClick = {&#10;                            if (menuItem.route == &quot;cashier&quot;) {&#10;                                onMenuClick(PosRoutes.POS)&#10;                            } else {&#10;                                onMenuClick(menuItem.route)&#10;                            }&#10;                        }&#10;                    )&#10;                }&#10;            }&#10;        }&#10;    }&#10;}&#10;&#10;/**&#10; * Stateful wrapper that keeps ViewModel usage and side-effects.&#10; * Collects state and delegates rendering to HomeScreenContent.&#10; */&#10;@OptIn(ExperimentalMaterial3Api::class)&#10;@Composable&#10;fun HomeScreen(&#10;    onMenuClick: (String) -&gt; Unit,&#10;    onLogout: () -&gt; Unit,&#10;    modifier: Modifier = Modifier,&#10;    viewModel: HomeViewModel = hiltViewModel()&#10;) {&#10;    val showLogoutDialog = remember { mutableStateOf(false) }&#10;    val currentUser by viewModel.currentUser.collectAsState()&#10;    val isLoggingOut by viewModel.isLoggingOut.collectAsState()&#10;&#10;    // Reports ViewModel to read dashboard summary (if available)&#10;    val reportsViewModel: ReportsViewModel = hiltViewModel()&#10;    val reportsUiState by reportsViewModel.uiState.collectAsState()&#10;    val dashboard = reportsUiState.dashboard&#10;&#10;    // Ensure we request &quot;TODAY&quot; dashboard when HomeScreen is shown so card reflects today's sales&#10;    LaunchedEffect(currentUser) {&#10;        val cashierIdToSet = if (currentUser?.role?.name == &quot;ADMIN&quot;) null else currentUser?.id&#10;        reportsViewModel.onEvent(ReportsEvent.SetCashierFilter(cashierIdToSet))&#10;        reportsViewModel.onEvent(ReportsEvent.SelectPeriod(PeriodType.TODAY))&#10;    }&#10;&#10;    // Permission: include Settings menu for cashier only if cashier has canEditSettings permission&#10;    val securityVm: SecuritySettingsViewModel = hiltViewModel()&#10;    val includeSettingsForCashier = usePermission(securityVm.observePermission(&quot;CASHIER&quot;) { it.canEditSettings })&#10;    val menuList = MenuItems.items(isAdmin = currentUser?.role?.name == &quot;ADMIN&quot;, includeSettingsForCashier = includeSettingsForCashier)&#10;&#10;    // Read store settings (name + logo preview) so header shows real data and graceful placeholder&#10;    val storeSettingsVm: StoreSettingsViewModel = hiltViewModel()&#10;    val storeUiState by storeSettingsVm.uiState.collectAsState()&#10;    val storeName = storeUiState.settings?.storeName&#10;    val storeLogoUri = storeUiState.logoPreviewUri&#10;&#10;    HomeScreenContent(&#10;        currentUserName = currentUser?.name,&#10;        storeName = storeName,&#10;        storeLogoUri = storeLogoUri,&#10;        totalSales = dashboard?.totalRevenue?.roundToLong(),&#10;        transactionCount = dashboard?.transactionCount,&#10;        netChange = reportsUiState.dashboardRevenueChange?.roundToLong(),&#10;        isLoading = reportsUiState.isLoading,&#10;        menuList = menuList,&#10;        onMenuClick = onMenuClick,&#10;        onLogoutClick = { showLogoutDialog.value = true },&#10;        onRetry = { reportsViewModel.onEvent(ReportsEvent.Refresh) },&#10;        modifier = modifier&#10;    )&#10;&#10;    // Logout dialog handled here (stateful behavior)&#10;    if (showLogoutDialog.value) {&#10;        AlertDialog(&#10;            onDismissRequest = {&#10;                if (!isLoggingOut) showLogoutDialog.value = false&#10;            },&#10;            title = { Text(&quot;Logout&quot;) },&#10;            text = {&#10;                if (isLoggingOut) {&#10;                    Row(horizontalArrangement = Arrangement.spacedBy(8.dp), verticalAlignment = androidx.compose.ui.Alignment.CenterVertically) {&#10;                        CircularProgressIndicator(modifier = Modifier.size(24.dp))&#10;                        Text(&quot;Sedang logout...&quot;)&#10;                    }&#10;                } else {&#10;                    Text(&quot;Apakah Anda yakin ingin keluar?&quot;)&#10;                }&#10;            },&#10;            confirmButton = {&#10;                TextButton(&#10;                    onClick = {&#10;                        viewModel.logout {&#10;                            showLogoutDialog.value = false&#10;                            onLogout()&#10;                        }&#10;                    },&#10;                    enabled = !isLoggingOut&#10;                ) { Text(&quot;Ya&quot;) }&#10;            },&#10;            dismissButton = {&#10;                TextButton(onClick = { showLogoutDialog.value = false }, enabled = !isLoggingOut) { Text(&quot;Batal&quot;) }&#10;            }&#10;        )&#10;    }&#10;}&#10;&#10;@Preview(showBackground = true)&#10;@Composable&#10;fun HomeScreenPreview() {&#10;    val sampleMenu = MenuItems.items(isAdmin = true)&#10;    MaterialTheme {&#10;        HomeScreenContent(&#10;            currentUserName = &quot;Demo User&quot;,&#10;            storeName = &quot;Toko Demo&quot;,&#10;            storeLogoUri = null,&#10;            totalSales = 123450L,&#10;            transactionCount = 12,&#10;            netChange = 5000L,&#10;            isLoading = false,&#10;            menuList = sampleMenu,&#10;            onMenuClick = {},&#10;            onLogoutClick = {},&#10;            onRetry = {}&#10;        )&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>