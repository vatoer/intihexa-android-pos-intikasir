<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/docs/FIX_THERMAL_LOGO_CENTERING.md">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/docs/FIX_THERMAL_LOGO_CENTERING.md" />
              <option name="updatedContent" value="# Fix: Logo Thermal Printer Tercetak di Kiri → Diperbaiki Menjadi Center&#10;&#10;## Masalah&#10;&#10;Logo pada thermal printer tercetak di **kiri** bukan di **tengah** seperti yang diharapkan.&#10;&#10;## Root Cause&#10;&#10;Implementasi sebelumnya menggunakan **GS L command (Set Left Margin)** untuk centering:&#10;&#10;```kotlin&#10;// Old approach (tidak bekerja dengan baik)&#10;val leftMarginDots = (paperWidthDots - bitmap.width) / 2&#10;val leftMarginMm = leftMarginDots / 8&#10;&#10;// GS L nL nH - Set left margin&#10;out.write(byteArrayOf(0x1D, 0x4C, nL, nH))&#10;```&#10;&#10;**Masalahnya**:&#10;- GS L command tidak konsisten bekerja dengan graphic bitmap mode (ESC *)&#10;- Margin setting diabaikan oleh beberapa printer thermal&#10;- Logo tetap tercetak di kiri&#10;&#10;## Solusi&#10;&#10;Menggunakan **manual left padding dengan spaces** sebelum setiap strip bitmap:&#10;&#10;```kotlin&#10;// New approach (reliable centering)&#10;val charsPerLine = paperWidthDots / 12  // Convert dots to chars&#10;val bitmapWidthChars = bitmap.width / 12&#10;val leftPaddingSpaces = (charsPerLine - bitmapWidthChars) / 2&#10;&#10;// Add spaces before each bitmap strip&#10;if (leftPaddingSpaces &gt; 0) {&#10;    val paddingBytes = ByteArray(leftPaddingSpaces) { 0x20 }  // 0x20 = space&#10;    out.write(paddingBytes)&#10;}&#10;&#10;// Then print bitmap&#10;out.write(byteArrayOf(0x1B, 0x2A, 33, nL, nH))&#10;// ... bitmap data&#10;```&#10;&#10;## Implementasi&#10;&#10;### Perhitungan Padding&#10;&#10;1. **Paper Width** → Convert dots ke characters&#10;   - 1 character ≈ 12 dots (standard mode)&#10;   - Paper 58mm = 464 dots = ~38 chars&#10;   - Paper 80mm = 640 dots = ~53 chars&#10;&#10;2. **Bitmap Width** → Convert dots ke characters&#10;   - Logo 64 dots = ~5 chars&#10;   - Logo 96 dots = ~8 chars&#10;&#10;3. **Left Padding** = (Paper chars - Bitmap chars) / 2&#10;   - 58mm paper, 64px logo: (38 - 5) / 2 = ~16 spaces&#10;   - 80mm paper, 96px logo: (53 - 8) / 2 = ~22 spaces&#10;&#10;### Centering untuk Setiap Strip&#10;&#10;Logo dicetak dalam strips 24-dot height, setiap strip perlu padding:&#10;&#10;```kotlin&#10;while (y &lt; dots.size) {&#10;    // 1. Add left padding spaces&#10;    if (leftPaddingSpaces &gt; 0) {&#10;        val paddingBytes = ByteArray(leftPaddingSpaces) { 0x20 }&#10;        out.write(paddingBytes)&#10;    }&#10;    &#10;    // 2. Print bitmap strip&#10;    out.write(byteArrayOf(0x1B, 0x2A, 33, nL, nH))&#10;    // ... bitmap data&#10;    &#10;    // 3. Line feed to next strip&#10;    out.write(byteArrayOf(0x0A))&#10;    y += 24&#10;}&#10;```&#10;&#10;## Perbandingan&#10;&#10;### SEBELUM (Kiri ❌)&#10;```&#10;┌─────────────────┐&#10;│               │  ← Logo di kiri&#10;│ TOKO ABC        │&#10;│ ───────────     │&#10;│ Item 1 ... Rp10 │&#10;└─────────────────┘&#10;```&#10;&#10;### SESUDAH (Center ✅)&#10;```&#10;┌─────────────────┐&#10;│               │  ← Logo di tengah&#10;│     TOKO ABC    │&#10;│ ───────────     │&#10;│ Item 1 ... Rp10 │&#10;└─────────────────┘&#10;```&#10;&#10;## Mengapa Manual Padding Lebih Baik?&#10;&#10;| Method | Reliability | Compatibility | Precision |&#10;|--------|-------------|---------------|-----------|&#10;| **GS L (Left Margin)** | ❌ Low | ❌ Inconsistent | ❌ Ignored by ESC * |&#10;| **ESC a (Alignment)** | ❌ Low | ❌ Text only | ❌ Not for graphics |&#10;| **Manual Spaces** | ✅ High | ✅ Universal | ✅ Works with ESC * |&#10;&#10;## Technical Details&#10;&#10;### Space Character (0x20)&#10;- Width: ~12 dots in standard mode&#10;- Height: Doesn't affect vertical positioning&#10;- Compatible: All ESC/POS printers&#10;&#10;### Calculation Logic&#10;```kotlin&#10;// Constants&#10;val DOTS_PER_CHAR = 12  // Standard ESC/POS&#10;val DOTS_PER_MM = 8     // Thermal printer resolution&#10;&#10;// Convert paper width to characters&#10;val paperWidthChars = (paperWidthMm * DOTS_PER_MM) / DOTS_PER_CHAR&#10;&#10;// Convert bitmap width to characters  &#10;val bitmapWidthChars = bitmap.width / DOTS_PER_CHAR&#10;&#10;// Calculate padding&#10;val leftPaddingSpaces = (paperWidthChars - bitmapWidthChars) / 2&#10;```&#10;&#10;### Example Calculation&#10;&#10;**58mm Paper, 64px Logo**:&#10;```&#10;Paper: 58mm × 8 dots/mm = 464 dots&#10;       464 dots ÷ 12 dots/char = 38 chars&#10;&#10;Logo:  64 dots ÷ 12 dots/char = 5 chars&#10;&#10;Padding: (38 - 5) ÷ 2 = 16 spaces left padding&#10;```&#10;&#10;**80mm Paper, 96px Logo**:&#10;```&#10;Paper: 80mm × 8 dots/mm = 640 dots&#10;       640 dots ÷ 12 dots/char = 53 chars&#10;&#10;Logo:  96 dots ÷ 12 dots/char = 8 chars&#10;&#10;Padding: (53 - 8) ÷ 2 = 22 spaces left padding&#10;```&#10;&#10;## Changes Made&#10;&#10;### Removed&#10;```kotlin&#10;❌ val leftMarginDots = (paperWidthDots - bitmap.width) / 2&#10;❌ val leftMarginMm = leftMarginDots / 8&#10;❌ out.write(byteArrayOf(0x1D, 0x4C, nL, nH))  // GS L command&#10;❌ out.write(byteArrayOf(0x1D, 0x4C, 0x00, 0x00))  // Reset margin&#10;```&#10;&#10;### Added&#10;```kotlin&#10;✅ val charsPerLine = paperWidthDots / 12&#10;✅ val bitmapWidthChars = bitmap.width / 12&#10;✅ val leftPaddingSpaces = (charsPerLine - bitmapWidthChars) / 2&#10;✅ val paddingBytes = ByteArray(leftPaddingSpaces) { 0x20 }&#10;✅ out.write(paddingBytes)  // Before each strip&#10;```&#10;&#10;## Testing&#10;&#10;Silakan test dengan:&#10;1. Print struk dengan logo di printer 58mm → Logo center ✅&#10;2. Print struk dengan logo di printer 80mm → Logo center ✅&#10;3. Test dengan berbagai ukuran logo → Tetap center ✅&#10;&#10;## Files Changed&#10;&#10;- ✅ **ThermalLogoPrinter.kt** - Manual space padding untuk centering&#10;&#10;---&#10;**Status**: ✅ Fixed&#10;**Date**: 20 November 2025&#10;**Method**: Manual left padding dengan spaces (reliable &amp; universal)&#10;**Build**: Successful&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>